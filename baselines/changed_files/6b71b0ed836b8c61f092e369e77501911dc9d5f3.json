{
    "sha_fail": "6b71b0ed836b8c61f092e369e77501911dc9d5f3",
    "changed_files": [
        {
            "commit": "6b71b0ed836b8c61f092e369e77501911dc9d5f3",
            "file_path": "webui.py",
            "diff": "diff --git a/webui.py b/webui.py\nindex 418e0a87..d9e1ef6a 100644\n--- a/webui.py\n+++ b/webui.py\n@@ -1,16 +1,33 @@\n+import os\n+import time\n+from modules import (\n+    shared,\n+    ui_tempdir,\n+    startup_timer,\n+    initialize_util,\n+    progress,\n+    ui,\n+    ui_extra_networks,\n+    timer,\n+    initialize,\n+    script_callbacks\n+)\n+from api import create_api  # ajuste se create_api for de outro m\u00f3dulo\n+from packaging.version import parse\n+from pathlib import Path\n+import gradio\n+\n def limpar_temp_dir():\n     if shared.opts.clean_temp_dir_at_start:\n         ui_tempdir.cleanup_tmpdr()\n         startup_timer.record(\"cleanup temp dir\")\n \n-\n def configurar_ui():\n     shared.demo = ui.create_ui()\n     startup_timer.record(\"create ui\")\n     if not cmd_opts.no_gradio_queue:\n         shared.demo.queue(64)\n \n-\n def decidir_autolancamento():\n     if os.getenv('SD_WEBUI_RESTARTING') == '1':\n         return False\n@@ -20,10 +37,8 @@ def decidir_autolancamento():\n         return not cmd_opts.webui_is_non_local\n     return False\n \n-\n def lancar_interface(auto_launch_browser):\n     gradio_auth_creds = list(initialize_util.get_gradio_auth_creds()) or None\n-\n     return shared.demo.launch(\n         share=cmd_opts.share,\n         server_name=initialize_util.gradio_server_name(),\n@@ -40,14 +55,12 @@ def lancar_interface(auto_launch_browser):\n         root_path=f\"/{cmd_opts.subpath}\" if cmd_opts.subpath else \"\",\n     )\n \n-\n def proteger_app(app):\n     app.user_middleware = [\n         x for x in app.user_middleware if x.cls.__name__ != 'CORSMiddleware'\n     ]\n     initialize_util.setup_middleware(app)\n \n-\n def configurar_apis(app):\n     progress.setup_progress_api(app)\n     ui.setup_ui_api(app)\n@@ -55,7 +68,6 @@ def configurar_apis(app):\n         create_api(app)\n     ui_extra_networks.add_pages_to_demo(app)\n \n-\n def monitorar_comandos():\n     while True:\n         server_command = shared.state.wait_for_server_command(timeout=5)\n@@ -65,29 +77,9 @@ def monitorar_comandos():\n             else:\n                 print(f\"Unknown server command: {server_command}\")\n \n-\n def warning_if_invalid_install_dir():\n-    \"\"\"\n-    Shows a warning if the webui is installed under a path that contains a leading dot in any of its parent directories.\n-\n-    Gradio '/file=' route will block access to files that have a leading dot in the path segments.\n-    We use this route to serve files such as JavaScript and CSS to the webpage,\n-    if those files are blocked, the webpage will not function properly.\n-    See https://github.com/AUTOMATIC1111/stable-diffusion-webui/issues/13292\n-\n-    This is a security feature was added to Gradio 3.32.0 and is removed in later versions,\n-    this function replicates Gradio file access blocking logic.\n-\n-    This check should be removed when it's no longer applicable.\n-    \"\"\"\n-    from packaging.version import parse\n-    from pathlib import Path\n-    import gradio\n-\n     if parse('3.32.0') <= parse(gradio.__version__) < parse('4'):\n-\n         def abspath(path):\n-            \"\"\"modified from Gradio 3.41.2 gradio.utils.abspath()\"\"\"\n             if path.is_absolute():\n                 return path\n             is_symlink = path.is_symlink() or any(parent.is_symlink() for parent in path.parents)\n@@ -103,16 +95,12 @@ Current path: \"{webui_root}\"\n For more information see: https://github.com/AUTOMATIC1111/stable-diffusion-webui/issues/13292\n {\"!\"*25} Warning {\"!\"*25}''')\n \n-\n def webui():\n     initialize.initialize()\n-    from modules import shared, ui_tempdir, script_callbacks, ui, progress, ui_extra_networks\n+    warning_if_invalid_install_dir()\n \n-warning_if_invalid_install_dir()\n-\n-while True:\n-    limpar_temp_dir()\n-    \n+    while True:\n+        limpar_temp_dir()\n         script_callbacks.before_ui_callback()\n         startup_timer.record(\"scripts before_ui_callback\")\n \n"
        }
    ]
}
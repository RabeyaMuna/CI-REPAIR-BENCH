{
    "sha_fail": "c9766a5e3d0c982cd148a391e63fb0f7c386b17e",
    "changed_files": [
        {
            "commit": "c9766a5e3d0c982cd148a391e63fb0f7c386b17e",
            "file_path": "taipy/core/_entity/_reload.py",
            "diff": "diff --git a/taipy/core/_entity/_reload.py b/taipy/core/_entity/_reload.py\nindex c484470b..97333f90 100644\n--- a/taipy/core/_entity/_reload.py\n+++ b/taipy/core/_entity/_reload.py\n@@ -11,6 +11,7 @@\n \n import functools\n from typing import Dict, Type\n+import threading\n \n from ...common._check_dependencies import EnterpriseEditionUtils\n from .._manager._manager import _Manager\n@@ -22,13 +23,15 @@ class _Reloader:\n     \"\"\"The _Reloader singleton class\"\"\"\n \n     _instance = None\n-    _no_reload_context = False\n-\n+    _lock = threading.RLock()\n     _managers: Dict[str, Type[_Manager]] = {}\n \n     def __new__(cls, *args, **kwargs):\n-        if not isinstance(cls._instance, cls):\n-            cls._instance = object.__new__(cls, *args, **kwargs)\n+        with cls._lock:\n+            if not isinstance(cls._instance, cls):\n+                cls._instance = super().__new__(cls, *args, **kwargs)\n+                cls._instance._no_reload_context = False  # Initialize once\n+                cls._instance._context_depth = 0  # Track nested `with` usage\n             cls._managers = cls._build_managers()\n         return cls._instance\n \n@@ -46,11 +49,16 @@ class _Reloader:\n         return entity\n \n     def __enter__(self):\n-        self._no_reload_context = True\n+        with self._lock:\n+            self._context_depth += 1\n+            self._no_reload_context = True\n         return self\n \n     def __exit__(self, exc_type, exc_value, exc_traceback):\n-        self._no_reload_context = False\n+        with self._lock:\n+            self._context_depth -= 1\n+            if self._context_depth == 0:\n+                self._no_reload_context = False\n \n     @classmethod\n     @functools.lru_cache\n"
        },
        {
            "commit": "c9766a5e3d0c982cd148a391e63fb0f7c386b17e",
            "file_path": "taipy/core/scenario/scenario.py",
            "diff": "diff --git a/taipy/core/scenario/scenario.py b/taipy/core/scenario/scenario.py\nindex 813403db..08fc9c02 100644\n--- a/taipy/core/scenario/scenario.py\n+++ b/taipy/core/scenario/scenario.py\n@@ -745,6 +745,9 @@ class Scenario(_Entity, Submittable, _Labeled):\n             self._additional_data_nodes.discard(dn_id)  # type: ignore[arg-type]\n         return additional_data_nodes\n \n+    def _get_existing_tasks(self) -> Dict[str, Task]:\n+        return self.__get_tasks(raise_not_existing=False)\n+\n     def __get_tasks(self, raise_not_existing: bool = True) -> Dict[str, Task]:\n         from ..task._task_manager_factory import _TaskManagerFactory\n \n"
        },
        {
            "commit": "c9766a5e3d0c982cd148a391e63fb0f7c386b17e",
            "file_path": "taipy/core/taipy.py",
            "diff": "diff --git a/taipy/core/taipy.py b/taipy/core/taipy.py\nindex 559d8fd3..3812899c 100644\n--- a/taipy/core/taipy.py\n+++ b/taipy/core/taipy.py\n@@ -910,7 +910,7 @@ def create_scenario(\n         SystemExit: If the configuration check returns some errors.\n \n     \"\"\"\n-    Orchestrator._manage_version_and_block_config()\n+    Orchestrator()._manage_version_and_block_config()\n \n     return _ScenarioManagerFactory._build_manager()._create(config, creation_date, name)\n \n@@ -935,7 +935,7 @@ def create_global_data_node(config: DataNodeConfig) -> DataNode:\n     if config.scope is not Scope.GLOBAL:\n         raise DataNodeConfigIsNotGlobal(config.id)\n \n-    Orchestrator._manage_version_and_block_config()\n+    Orchestrator()._manage_version_and_block_config()\n \n     if dns := _DataManagerFactory._build_manager()._get_by_config_id(config.id):\n         return dns[0]\n"
        },
        {
            "commit": "c9766a5e3d0c982cd148a391e63fb0f7c386b17e",
            "file_path": "tests/core/_entity/test_reload.py",
            "diff": "diff --git a/tests/core/_entity/test_reload.py b/tests/core/_entity/test_reload.py\nnew file mode 100644\nindex 00000000..e2789501\n--- /dev/null\n+++ b/tests/core/_entity/test_reload.py\n@@ -0,0 +1,91 @@\n+# Copyright 2021-2025 Avaiga Private Limited\n+#\n+# Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+# the License. You may obtain a copy of the License at\n+#\n+#        http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+# an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+# specific language governing permissions and limitations under the License.\n+from datetime import datetime\n+\n+import pytest\n+\n+import taipy as tp\n+from taipy import Config\n+from taipy.core._entity._reload import _Reloader\n+\n+\n+@pytest.fixture(scope=\"function\", autouse=True)\n+def reset_reloader():\n+    \"\"\"Reset the _Reloader singleton between tests.\"\"\"\n+    _Reloader._instance = None\n+    _Reloader._no_reload_context = False\n+    _Reloader._context_depth = 0\n+    yield\n+    _Reloader._instance = None\n+    _Reloader._no_reload_context = False\n+    _Reloader._context_depth = 0\n+\n+\n+class TestReloader:\n+    def test_initial_state(self):\n+        reloader = _Reloader()\n+        assert reloader._context_depth == 0\n+        assert not reloader._no_reload_context\n+\n+    def test_single_context(self):\n+        dn = tp.create_global_data_node(Config.configure_data_node(\"dn1\", scope=tp.Scope.GLOBAL))\n+        assert len(dn.edits) == 0\n+        edit = {\"comments\": \"inside\", \"timestamp\": datetime.now()}\n+        dn._edits.append(edit) # add a new edit in memory without saving the data node\n+        reloader = _Reloader()\n+        with reloader:\n+            assert reloader._context_depth == 1\n+            assert reloader._no_reload_context\n+            assert len(dn.edits) == 1 # The dn is not reloaded so the edit is still there\n+        assert reloader._context_depth == 0\n+        assert not reloader._no_reload_context\n+        assert len(dn.edits) == 0 # The dn is reloaded so the edit is removed\n+\n+    def test_nested_contexts(self):\n+        dn = tp.create_global_data_node(Config.configure_data_node(\"dn1\", scope=tp.Scope.GLOBAL))\n+        assert len(dn.edits) == 0\n+        edit = {\"comments\": \"inside\", \"timestamp\": datetime.now()}\n+        dn._edits.append(edit)  # add a new edit in memory without saving the data node\n+        reloader = _Reloader()\n+        with reloader:\n+            assert reloader._context_depth == 1\n+            assert reloader._no_reload_context\n+            assert len(dn.edits) == 1 # The dn is not reloaded so the edit is still there\n+            with reloader:\n+                assert reloader._context_depth == 2\n+                assert reloader._no_reload_context\n+                assert len(dn.edits) == 1 # The dn is not reloaded so the edit is still there\n+                with reloader:\n+                    assert reloader._context_depth == 3\n+                    assert reloader._no_reload_context\n+                    assert len(dn.edits) == 1 # The dn is not reloaded so the edit is still there\n+                assert reloader._context_depth == 2\n+                assert reloader._no_reload_context\n+                assert len(dn.edits) == 1 # The dn is not reloaded so the edit is still there\n+            assert reloader._context_depth == 1\n+            assert reloader._no_reload_context\n+            assert len(dn.edits) == 1 # The dn is not reloaded so the edit is still there\n+        assert reloader._context_depth == 0\n+        assert not reloader._no_reload_context\n+        assert len(dn.edits) == 0 # The dn is reloaded so the edit is removed\n+\n+    def test_exception_handling(self):\n+        reloader = _Reloader()\n+        try:\n+            with reloader:\n+                assert reloader._context_depth == 1\n+                assert reloader._no_reload_context\n+                raise ValueError(\"Test exception\")\n+        except ValueError:\n+            pass\n+\n+        assert reloader._context_depth == 0\n+        assert not reloader._no_reload_context\n"
        }
    ]
}
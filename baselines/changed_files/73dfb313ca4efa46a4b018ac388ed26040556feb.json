{
    "sha_fail": "73dfb313ca4efa46a4b018ac388ed26040556feb",
    "changed_files": [
        {
            "commit": "73dfb313ca4efa46a4b018ac388ed26040556feb",
            "file_path": "doc/advanced.rst",
            "diff": "diff --git a/doc/advanced.rst b/doc/advanced.rst\nindex 73ce82c8..43a24a1e 100644\n--- a/doc/advanced.rst\n+++ b/doc/advanced.rst\n@@ -348,7 +348,7 @@ To start using the form rendering rules, put a list of form field names into the\n property one of your admin views::\n \n     class RuleView(sqla.ModelView):\n-        form_create_rules = ('email', 'first_name', 'last_name')\n+       form_create_rules = ['email', rules.Text('Foobar'), 'first_name', 'last_name']\n \n In this example, only three fields will be rendered and `email` field will be above other two fields.\n \n@@ -368,19 +368,70 @@ Built-in Rules\n \n Flask-Admin comes with few built-in rules that can be found in the :mod:`flask_admin.form.rules` module:\n \n-======================================================= ========================================================\n-Form Rendering Rule                                     Description\n-======================================================= ========================================================\n-:class:`flask_admin.form.rules.BaseRule`                All rules derive from this class\n-:class:`flask_admin.form.rules.NestedRule`              Allows rule nesting, useful for HTML containers\n-:class:`flask_admin.form.rules.Text`                    Simple text rendering rule\n-:class:`flask_admin.form.rules.HTML`                    Same as `Text` rule, but does not escape the text\n-:class:`flask_admin.form.rules.Macro`                   Calls macro from current Jinja2 context\n-:class:`flask_admin.form.rules.Container`               Wraps child rules into container rendered by macro\n-:class:`flask_admin.form.rules.Field`                   Renders single form field\n-:class:`flask_admin.form.rules.Header`                  Renders form header\n-:class:`flask_admin.form.rules.FieldSet`                Renders form header and child rules\n-======================================================= ========================================================\n+================================================= ==================================================== ======================\n+Form Rendering Rule                               Description                                          Snippet\n+================================================= ==================================================== ======================\n+:class:`flask_admin.form.rules.BaseRule`          All rules derive from this class\n+                                                      rules.Text('Foobar')\n+:class:`flask_admin.form.rules.NestedRule`        Allows rule nesting, useful for HTML containers\n+:class:`flask_admin.form.rules.Text`              Simple text rendering rule                            ``rules.Text('Foobar')``\n+:class:`flask_admin.form.rules.HTML`              Same as `Text` rule, but does not escape the text     ``rules.HTML('<hr>')``\n+:class:`flask_admin.form.rules.Macro`             Calls macro from current Jinja2 context               ``rules.Macro('my_macro', arg1=1, arg2=2)``\n+:class:`flask_admin.form.rules.Container`         Wraps a child rule into container rendered by\n+                                                  macro, where the macro should be defined in the\n+                                                  current Jinja2 context containing ``{{caller()}}``\n+                                                  . read more in the next section.\n+:class:`flask_admin.form.rules.Field`             Renders single form field, helpful when it is used    ``rules.Field('email')``\n+                                                  with `NestedRule`\n+:class:`flask_admin.form.rules.Header`            Renders form header                                   ``rules.Header('Posts')``\n+:class:`flask_admin.form.rules.FieldSet`          Renders form header and child rules                   ``rules.FieldSet(('phone_number', 'email'), 'Contacts:')``\n+:class:`flask_admin.form.rules.Row`               Renders child rules in a single row                   ``rules.Row(('dialing_code', 'phone_number'), 'Contacts:')``\n+:class:`flask_admin.form.rules.Group`             Bootstrap Input field in a group style. It            ``rules.Group('dialling_code', prepend='+')``\n+                                                  renders the target field whatever its type\n+                                                  is (text, radio, checkbox..etc), allowing a\n+                                                  prepended and appended boxes to be filled\n+                                                  with any HTML content.\n+================================================= ==================================================== ======================\n+\n+**Rules and Macros**\n+Each one of the ``Macro`` and ``Container`` rules needs a macros to be deifined\n+in advance. As an example of Container rule, Let's say we want to warp some fields winthin a\n+[Bootstrap Card](https://getbootstrap.com/docs/4.6/components/card/), then we can define a Jinja Macro\n+that includes ``caller()`` which is a functoin to be placed where we want to render the contained rule.\n+We can extend the ``create.html`` as the following::\n+\n+    {% extends 'admin/model/create.html' %}\n+\n+    {% macro wrap_in_card( ) %}\n+\n+    <div class=\"card\">\n+        <div class=\"card-header\">\n+            <h5>Some Fields </h5>\n+        </div>\n+        <div class=\"card-body\">\n+            <!-- the rule will be rendered here -->\n+            {{ caller() }}\n+        </div>\n+    </div>\n+\n+    {% endmacro %}\n+\n+Now the ``wrap_in_card`` macro can be passed to the container rule like: ::\n+\n+    from flask_admin.form import rules\n+\n+    class RuleView(sqla.ModelView):\n+        create_template = 'admin/create.html'\n+        form_create_rules = [\n+            rules.Container('wrap_in_card',\n+                rules.NestedRule( separator='<hr>', rules= [\n+                    rules.Field('field1'),\n+                    rules.Field('field2'),\n+                    rules.Field('field3'),\n+                ]),\n+            )\n+    ]\n+\n \n .. _database-backends:\n \n"
        },
        {
            "commit": "73dfb313ca4efa46a4b018ac388ed26040556feb",
            "file_path": "examples/sqla/admin/main.py",
            "diff": "diff --git a/examples/sqla/admin/main.py b/examples/sqla/admin/main.py\nindex f9da11bf..15277378 100644\n--- a/examples/sqla/admin/main.py\n+++ b/examples/sqla/admin/main.py\n@@ -7,6 +7,7 @@ from flask_admin.contrib.sqla import filters\n from flask_admin.contrib.sqla import ModelView\n from flask_admin.contrib.sqla.filters import BaseSQLAFilter\n from flask_admin.contrib.sqla.filters import FilterEqual\n+from flask_admin.form import rules\n from flask_admin.theme import Bootstrap4Theme\n from markupsafe import Markup\n from wtforms import validators\n@@ -133,6 +134,46 @@ class UserAdmin(ModelView):\n         \"email\",\n     ]\n \n+    create_template = \"admin/users/create.html\"\n+    form_create_rules = [\n+        rules.Header(\"Users\"),  # HTML header\n+        rules.HTML(\"<hr>\"),  # HTML horizontal line\n+        \"last_name\",  # show it as first field\n+        \"first_name\",  # show it as second field\n+        rules.Text(\"Foobar\"),  # static text\n+        rules.FieldSet(\n+            (\n+                \"type\",\n+                rules.Row(\n+                    rules.Group(\n+                        \"dialling_code\",\n+                        prepend=\"\u2795\",\n+                        append='<i class=\"fa fa-phone\"></i>',\n+                    ),\n+                    \"local_phone_number\",\n+                    \"email\",\n+                ),\n+                rules.Text(\"--- The end of contact details ---\"),\n+            ),\n+            \"Contact details:\",\n+        ),  # field set with legend\n+        # custom container (see templates/admin/create.html)\n+        rules.Container(\n+            \"wrap_in_card\",\n+            rules.NestedRule(\n+                separator=\"<hr>\",\n+                rules=[\n+                    rules.Field(\"enum_choice_field\"),\n+                    rules.Field(\"sqla_utils_choice_field\"),\n+                    rules.Field(\"sqla_utils_enum_choice_field\"),\n+                ],\n+            ),\n+            card_title=\"Some Choices\",\n+        ),\n+        # render a macro (see templates/admin/create.html)\n+        rules.Macro(\"my_macro\", arg1=\"Just a Title\", arg2=\"bla bla bla\"),\n+    ]\n+\n     column_auto_select_related = True\n     column_default_sort = [\n         (\"last_name\", False),\n"
        },
        {
            "commit": "73dfb313ca4efa46a4b018ac388ed26040556feb",
            "file_path": "examples/sqla/admin/templates/admin/users/create.html",
            "diff": "diff --git a/examples/sqla/admin/templates/admin/users/create.html b/examples/sqla/admin/templates/admin/users/create.html\nnew file mode 100644\nindex 00000000..611e429e\n--- /dev/null\n+++ b/examples/sqla/admin/templates/admin/users/create.html\n@@ -0,0 +1,29 @@\n+{% extends 'admin/model/create.html' %}\n+\n+\n+{% macro wrap_in_card( card_title ) %}\n+\n+  <div class=\"card\">\n+      <div class=\"card-header\">\n+          <h5> {{ card_title }} </h5>\n+      </div>\n+      <div class=\"card-body\">\n+          {{ caller() }}\n+      </div>\n+</div>\n+\n+{% endmacro %}\n+\n+\n+{% macro my_macro(arg1, arg2) %}\n+\n+  <div class=\"card\">\n+      <div class=\"card-header\">\n+          <h5>{{ arg1 }} </h5>\n+      </div>\n+      <div class=\"card-body\">\n+          {{ arg2 }}\n+      </div>\n+</div>\n+\n+{% endmacro %}\n"
        },
        {
            "commit": "73dfb313ca4efa46a4b018ac388ed26040556feb",
            "file_path": "flask_admin/form/rules.py",
            "diff": "diff --git a/flask_admin/form/rules.py b/flask_admin/form/rules.py\nindex 6fba4077..2d6c46d5 100644\n--- a/flask_admin/form/rules.py\n+++ b/flask_admin/form/rules.py\n@@ -11,6 +11,7 @@ from flask_admin._compat import string_types\n from flask_admin._types import T_FORM_OPTS\n from flask_admin._types import T_INLINE_BASE_FORM_ADMIN\n from flask_admin._types import T_MODEL_VIEW\n+from flask_admin._types import T_RULES_SEQUENCE\n from flask_admin._types import T_TRANSLATABLE\n \n \n@@ -71,7 +72,7 @@ class NestedRule(BaseRule):\n \n     def __init__(\n         self,\n-        rules: t.Optional[t.Sequence[t.Union[str, \"Header\"]]] = None,  # ruff: noqa\n+        rules: t.Optional[T_RULES_SEQUENCE] = None,  # ruff: noqa\n         separator: str = \"\",\n     ) -> None:\n         \"\"\"\n@@ -283,6 +284,12 @@ class Container(Macro):\n             Child rule to be rendered inside of container\n         :param kwargs:\n             Container macro arguments\n+\n+\n+        The container is nothing but a Jinja Macro\n+        that is placed within the current jinja context. The rule inside the container\n+        is represented by `{{ caller() }}` as it is shown in the follwoing Jinja\n+        [snippet](/advanced/index.html#built-in-rules):\n         \"\"\"\n         super().__init__(macro_name, **kwargs)\n         self.child_rule = child_rule\n@@ -414,7 +421,7 @@ class FieldSet(NestedRule):\n \n     def __init__(\n         self,\n-        rules: t.Sequence[str],\n+        rules: T_RULES_SEQUENCE,\n         header: T_TRANSLATABLE | None = None,\n         separator: str = \"\",\n     ) -> None:\n@@ -437,9 +444,13 @@ class FieldSet(NestedRule):\n \n \n class Row(NestedRule):\n-    def __init__(self, *columns: BaseRule, **kw: t.Any) -> None:\n+    \"\"\"\n+    Takes a list of rules and render them in a single row.\n+    \"\"\"\n+\n+    def __init__(self, *columns: str | BaseRule, **kw: t.Any) -> None:\n         super().__init__()\n-        self.rules: list[str | Header | BaseRule] = columns  # type:ignore[assignment]\n+        self.rules: list[str | BaseRule] = columns  # type:ignore[assignment]\n \n     def __call__(\n         self,\n@@ -475,7 +486,10 @@ class Group(Macro):\n         **kwargs: t.Any,\n     ) -> None:\n         \"\"\"\n-        Bootstrap Input group.\n+        [Bootstrap Input group](https://getbootstrap.com/docs/4.6/components/input-group/).\n+        It renders the target field whatever its type is\n+        (text, radio, checkbox..etc), allowing prepended and appended boxes to\n+        be filled with any HTML content.\n         \"\"\"\n         render_field = kwargs.get(\"render_field\", \"lib.render_field\")\n         super().__init__(render_field)\n"
        },
        {
            "commit": "73dfb313ca4efa46a4b018ac388ed26040556feb",
            "file_path": "flask_admin/tests/sqla/test_form_rules.py",
            "diff": "diff --git a/flask_admin/tests/sqla/test_form_rules.py b/flask_admin/tests/sqla/test_form_rules.py\nindex 8f7807f7..d408853f 100644\n--- a/flask_admin/tests/sqla/test_form_rules.py\n+++ b/flask_admin/tests/sqla/test_form_rules.py\n@@ -90,6 +90,46 @@ def test_rule_container(app, db, admin):\n         assert pos1 < pos2 < pos3\n \n \n+@pytest.mark.filterwarnings(\"ignore:Fields missing:UserWarning\")\n+def test_rule_text(app, db, admin):\n+    with app.app_context():\n+        Model1, _ = create_models(db)\n+        db.create_all()\n+\n+        view = CustomModelView(\n+            Model1, db.session, form_create_rules=(rules.Text(\"hello\"),)\n+        )\n+        admin.add_view(view)\n+\n+        client = app.test_client()\n+\n+        rv = client.get(\"/admin/model1/new/\")\n+        assert rv.status_code == 200\n+\n+        data = rv.data.decode(\"utf-8\")\n+        assert \"hello\" in data\n+\n+\n+@pytest.mark.filterwarnings(\"ignore:Fields missing:UserWarning\")\n+def test_rule_html(app, db, admin):\n+    with app.app_context():\n+        Model1, _ = create_models(db)\n+        db.create_all()\n+\n+        view = CustomModelView(\n+            Model1, db.session, form_create_rules=(rules.HTML(\"<h1>hello</h1>\"),)\n+        )\n+        admin.add_view(view)\n+\n+        client = app.test_client()\n+\n+        rv = client.get(\"/admin/model1/new/\")\n+        assert rv.status_code == 200\n+\n+        data = rv.data.decode(\"utf-8\")\n+        assert \"<h1>hello</h1>\" in data\n+\n+\n @pytest.mark.filterwarnings(\"ignore:Fields missing:UserWarning\")\n def test_rule_header(app, db, admin):\n     with app.app_context():\n@@ -110,6 +150,109 @@ def test_rule_header(app, db, admin):\n         assert \"<h3>hello</h3>\" in data\n \n \n+@pytest.mark.filterwarnings(\"ignore:Fields missing:UserWarning\")\n+def test_rule_nested(app, db, admin):\n+    with app.app_context():\n+        Model1, _ = create_models(db)\n+        db.create_all()\n+\n+        view = CustomModelView(\n+            Model1,\n+            db.session,\n+            form_create_rules=(\n+                rules.NestedRule(\n+                    rules=[\n+                        rules.Text(\"hello1\"),\n+                        rules.Field(\"test2\"),\n+                        rules.Field(\"test1\"),\n+                        rules.Field(\"test4\"),\n+                    ]\n+                ),\n+            ),\n+        )\n+        admin.add_view(view)\n+\n+        client = app.test_client()\n+\n+        rv = client.get(\"/admin/model1/new/\")\n+        assert rv.status_code == 200\n+\n+        data = rv.data.decode(\"utf-8\")\n+        assert \"hello1\" in data\n+        pos1 = data.find(\"Test1\")\n+        pos2 = data.find(\"Test2\")\n+        pos3 = data.find(\"Test3\")\n+        pos4 = data.find(\"Test4\")\n+        assert pos1 > pos2\n+        assert pos4 > pos1\n+        assert pos3 == -1\n+\n+\n+@pytest.mark.filterwarnings(\"ignore:Fields missing:UserWarning\")\n+def test_rule_row(app, db, admin):\n+    with app.app_context():\n+        Model1, _ = create_models(db)\n+        db.create_all()\n+\n+        view = CustomModelView(\n+            Model1,\n+            db.session,\n+            form_create_rules=(\n+                rules.Row(\n+                    rules.Field(\"test1\"),\n+                    rules.Field(\"test2\"),\n+                ),\n+            ),\n+        )\n+        admin.add_view(view)\n+\n+        client = app.test_client()\n+\n+        rv = client.get(\"/admin/model1/new/\")\n+        assert rv.status_code == 200\n+\n+        data = rv.data.decode(\"utf-8\")\n+        pos1 = data.find(\"form-row\")\n+        pos2 = data.find(\"form-group col\", pos1)\n+        pos3 = data.find(\"Test1\", pos2)\n+        pos4 = data.find(\"form-group col\", pos3)\n+        pos5 = data.find(\"Test2\", pos4)\n+        assert pos1 < pos2 < pos3 < pos4 < pos5\n+\n+\n+@pytest.mark.filterwarnings(\"ignore:Fields missing:UserWarning\")\n+def test_rule_group(app, db, admin):\n+    with app.app_context():\n+        Model1, _ = create_models(db)\n+        db.create_all()\n+\n+        view = CustomModelView(\n+            Model1,\n+            db.session,\n+            form_create_rules=(\n+                rules.Group(\n+                    \"test1\",\n+                    prepend=\"before\",\n+                    append=\"after\",\n+                ),\n+            ),\n+        )\n+        admin.add_view(view)\n+\n+        client = app.test_client()\n+\n+        rv = client.get(\"/admin/model1/new/\")\n+        assert rv.status_code == 200\n+\n+        data = rv.data.decode(\"utf-8\")\n+        pos1 = data.find(\"form-group\")\n+        pos2 = data.find(\"Test1\", pos1)\n+        pos3 = data.find(\"before\", pos2)\n+        pos4 = data.find(\"form-control\", pos3)\n+        pos5 = data.find(\"after\", pos4)\n+        assert pos1 < pos2 < pos3 < pos4 < pos5\n+\n+\n @pytest.mark.filterwarnings(\"ignore:Fields missing:UserWarning\")\n def test_rule_field_set(app, db, admin):\n     with app.app_context():\n@@ -119,7 +262,11 @@ def test_rule_field_set(app, db, admin):\n         view = CustomModelView(\n             Model1,\n             db.session,\n-            form_create_rules=(rules.FieldSet([\"test2\", \"test1\", \"test4\"], \"header\"),),\n+            form_create_rules=(\n+                rules.FieldSet(\n+                    [\"test2\", \"test1\", \"test4\", rules.Text(\"helloworld\")], \"header\"\n+                ),\n+            ),\n         )\n         admin.add_view(view)\n \n@@ -134,9 +281,11 @@ def test_rule_field_set(app, db, admin):\n         pos2 = data.find(\"Test2\")\n         pos3 = data.find(\"Test3\")\n         pos4 = data.find(\"Test4\")\n+        pos5 = data.find(\"helloworld\")\n         assert pos1 > pos2\n         assert pos4 > pos1\n         assert pos3 == -1\n+        assert pos5 > pos4\n \n \n @pytest.mark.filterwarnings(\n"
        }
    ]
}
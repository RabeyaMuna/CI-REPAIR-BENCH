{
    "sha_fail": "8474427eeab92e28766b8051d92e6b46379581e9",
    "changed_files": [
        {
            "commit": "8474427eeab92e28766b8051d92e6b46379581e9",
            "file_path": "cookbook/models/anthropic/pdf_input_file_upload.py",
            "diff": "diff --git a/cookbook/models/anthropic/pdf_input_file_upload.py b/cookbook/models/anthropic/pdf_input_file_upload.py\nnew file mode 100644\nindex 000000000..21e078c7c\n--- /dev/null\n+++ b/cookbook/models/anthropic/pdf_input_file_upload.py\n@@ -0,0 +1,38 @@\n+\"\"\"\n+In this example, we upload a PDF file to Anthropic directly and then use it as an input to an agent.\n+\"\"\"\n+\n+from pathlib import Path\n+\n+from agno.agent import Agent\n+from agno.media import File\n+from agno.models.anthropic import Claude\n+from anthropic import Anthropic\n+\n+# Initialize Anthropic client\n+client = Anthropic()\n+\n+# Upload the file to Anthropic\n+file_path = Path(\n+    \"libs/agno/tests/integration/knowledge/data/thai_recipes_short.pdf\")\n+uploaded_file = client.beta.files.upload(\n+    file=file_path,\n+)\n+\n+print('Uploaded file:', uploaded_file)\n+\n+if uploaded_file is not None:\n+    agent = Agent(\n+        model=Claude(\n+            id=\"claude-opus-4-20250514\",\n+            default_headers={\n+                \"anthropic-beta\": \"code-execution-2025-05-22\"\n+            },\n+        ),\n+        markdown=True,\n+    )\n+\n+    agent.print_response(\n+        \"Summarize the contents of the attached file.\",\n+        files=[File(external=uploaded_file)],\n+    )\n"
        },
        {
            "commit": "8474427eeab92e28766b8051d92e6b46379581e9",
            "file_path": "libs/agno/agno/models/anthropic/claude.py",
            "diff": "diff --git a/libs/agno/agno/models/anthropic/claude.py b/libs/agno/agno/models/anthropic/claude.py\nindex a9bf5db45..47d3baf8c 100644\n--- a/libs/agno/agno/models/anthropic/claude.py\n+++ b/libs/agno/agno/models/anthropic/claude.py\n@@ -3,6 +3,7 @@ from collections.abc import AsyncIterator\n from dataclasses import dataclass\n from os import getenv\n from typing import Any, Dict, List, Optional, Type, Union\n+from pathlib import Path\n \n from pydantic import BaseModel\n \n@@ -12,6 +13,7 @@ from agno.models.message import Citations, DocumentCitation, Message, UrlCitatio\n from agno.models.response import ModelResponse\n from agno.utils.log import log_error, log_warning\n from agno.utils.models.claude import format_messages\n+from agno.media import File\n \n try:\n     from anthropic import Anthropic as AnthropicClient\n@@ -55,6 +57,7 @@ class Claude(Model):\n     # Client parameters\n     api_key: Optional[str] = None\n     client_params: Optional[Dict[str, Any]] = None\n+    default_headers: Optional[Dict[str, Any]] = None\n \n     # Anthropic clients\n     client: Optional[AnthropicClient] = None\n@@ -72,6 +75,8 @@ class Claude(Model):\n         # Add additional client parameters\n         if self.client_params is not None:\n             client_params.update(self.client_params)\n+        if self.default_headers is not None:\n+            client_params[\"default_headers\"] = self.default_headers\n         return client_params\n \n     def get_client(self) -> AnthropicClient:\n@@ -196,6 +201,7 @@ class Claude(Model):\n         \"\"\"\n         try:\n             chat_messages, system_message = format_messages(messages)\n+            print('--> chat_messages', chat_messages)\n             request_kwargs = self._prepare_request_kwargs(system_message, tools)\n \n             return self.get_client().messages.create(\n"
        },
        {
            "commit": "8474427eeab92e28766b8051d92e6b46379581e9",
            "file_path": "libs/agno/agno/utils/models/claude.py",
            "diff": "diff --git a/libs/agno/agno/utils/models/claude.py b/libs/agno/agno/utils/models/claude.py\nindex be57dc5fd..c0e9b1d8b 100644\n--- a/libs/agno/agno/utils/models/claude.py\n+++ b/libs/agno/agno/utils/models/claude.py\n@@ -116,6 +116,17 @@ def _format_file_for_message(file: File) -> Optional[Dict[str, Any]]:\n         \"application/pdf\": \"base64\",\n         \"text/plain\": \"text\",\n     }\n+    # Case 0: File is an Anthropic uploaded file\n+    print('file.external:', file.external)\n+    if file.external is not None and hasattr(file.external, 'id'):\n+        print('file.external.id:', file.external.id)\n+        return {\n+            \"type\": \"document\", \n+            \"source\": {\n+                \"type\": \"file\",\n+                \"file_id\": file.external.id,\n+            }\n+        }\n \n     # Case 1: Document is a URL\n     if file.url is not None:\n@@ -129,6 +140,7 @@ def _format_file_for_message(file: File) -> Optional[Dict[str, Any]]:\n         }\n     # Case 2: Document is a local file path\n     elif file.filepath is not None:\n+        print('--------')\n         import base64\n         from pathlib import Path\n \n"
        }
    ]
}
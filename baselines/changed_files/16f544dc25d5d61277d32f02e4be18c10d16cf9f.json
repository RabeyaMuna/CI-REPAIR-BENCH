{
    "sha_fail": "16f544dc25d5d61277d32f02e4be18c10d16cf9f",
    "changed_files": [
        {
            "commit": "16f544dc25d5d61277d32f02e4be18c10d16cf9f",
            "file_path": "sqlglot/dialects/doris.py",
            "diff": "diff --git a/sqlglot/dialects/doris.py b/sqlglot/dialects/doris.py\nindex ab1434e..af8114a 100644\n--- a/sqlglot/dialects/doris.py\n+++ b/sqlglot/dialects/doris.py\n@@ -3,13 +3,13 @@ from __future__ import annotations\n from sqlglot import exp\n from sqlglot.dialects.dialect import (\n     approx_count_distinct_sql,\n-    build_timestamp_trunc,\n     property_sql,\n     rename_func,\n     time_format,\n     unit_to_str,\n )\n from sqlglot.dialects.mysql import MySQL\n+from sqlglot.helper import seq_get\n from sqlglot.tokens import TokenType\n \n \n@@ -22,6 +22,22 @@ def _lag_lead_sql(self, expression: exp.Lag | exp.Lead) -> str:\n     )\n \n \n+# Accept both DATE_TRUNC(datetime, unit) and DATE_TRUNC(unit, datetime)\n+def _build_date_trunc(args: t.List[exp.Expression]) -> exp.Expression:\n+    a0, a1 = seq_get(args, 0), seq_get(args, 1)\n+\n+    def _is_unit_like(e: exp.Expression | None) -> bool:\n+        if not (isinstance(e, exp.Literal) and e.is_string):\n+            return False\n+        text = e.this\n+        return not any(ch.isdigit() for ch in text)\n+\n+    # Determine which argument is the unit\n+    unit, this = a0, a1 if _is_unit_like(a0) else a1, a0\n+\n+    return exp.TimestampTrunc(this=this, unit=unit)\n+\n+\n class Doris(MySQL):\n     DATE_FORMAT = \"'yyyy-MM-dd'\"\n     DATEINT_FORMAT = \"'yyyyMMdd'\"\n@@ -31,7 +47,7 @@ class Doris(MySQL):\n         FUNCTIONS = {\n             **MySQL.Parser.FUNCTIONS,\n             \"COLLECT_SET\": exp.ArrayUniqueAgg.from_arg_list,\n-            \"DATE_TRUNC\": build_timestamp_trunc,\n+            \"DATE_TRUNC\": _build_date_trunc,\n             \"MONTHS_ADD\": exp.AddMonths.from_arg_list,\n             \"REGEXP\": exp.RegexpLike.from_arg_list,\n             \"TO_DATE\": exp.TsOrDsToDate.from_arg_list,\n@@ -124,6 +140,7 @@ class Doris(MySQL):\n             **MySQL.Generator.PROPERTIES_LOCATION,\n             exp.UniqueKeyProperty: exp.Properties.Location.POST_SCHEMA,\n             exp.PartitionByRangeProperty: exp.Properties.Location.POST_SCHEMA,\n+            exp.PartitionedByProperty: exp.Properties.Location.POST_SCHEMA,\n         }\n \n         CAST_MAPPING = {}\n@@ -685,6 +702,13 @@ class Doris(MySQL):\n             create_sql = \", \".join(self.sql(e) for e in create_expressions)\n             return f\"PARTITION BY RANGE ({partition_expressions}) ({create_sql})\"\n \n+        def partitionedbyproperty_sql(self, expression: exp.PartitionedByProperty) -> str:\n+            node = expression.this\n+            if isinstance(node, exp.Schema):\n+                parts = \", \".join(self.sql(e) for e in node.expressions)\n+                return f\"PARTITION BY ({parts})\"\n+            return f\"PARTITION BY ({self.sql(node)})\"\n+\n         def table_sql(self, expression: exp.Table, sep: str = \" AS \") -> str:\n             \"\"\"Override table_sql to avoid AS keyword in UPDATE and DELETE statements.\"\"\"\n             ancestor = expression.find_ancestor(exp.Update, exp.Delete, exp.Select)\n"
        },
        {
            "commit": "16f544dc25d5d61277d32f02e4be18c10d16cf9f",
            "file_path": "tests/dialects/test_doris.py",
            "diff": "diff --git a/tests/dialects/test_doris.py b/tests/dialects/test_doris.py\nindex 3b6df7c..77eb5e1 100644\n--- a/tests/dialects/test_doris.py\n+++ b/tests/dialects/test_doris.py\n@@ -99,6 +99,8 @@ class TestDoris(Validator):\n \n     def test_time(self):\n         self.validate_identity(\"TIMESTAMP('2022-01-01')\")\n+        self.validate_identity(\"DATE_TRUNC(event_date, 'DAY')\")\n+        self.validate_identity(\"DATE_TRUNC('2010-12-02 19:28:30', 'HOUR')\")\n \n     def test_regex(self):\n         self.validate_all(\n@@ -126,7 +128,7 @@ class TestDoris(Validator):\n             \"CREATE TABLE test_table (c1 INT, c2 INT) DISTRIBUTED BY RANDOM BUCKETS 1\"\n         )\n \n-    def test_partitionbyrange(self):\n+    def test_partition(self):\n         self.validate_identity(\n             \"CREATE TABLE test_table (c1 INT, c2 DATE) PARTITION BY RANGE (`c2`) (PARTITION `p201701` VALUES LESS THAN ('2017-02-01'), PARTITION `p201702` VALUES LESS THAN ('2017-03-01'))\"\n         )\n@@ -136,6 +138,11 @@ class TestDoris(Validator):\n         self.validate_identity(\n             \"CREATE TABLE test_table (c1 INT, c2 DATE) PARTITION BY RANGE (`c2`) (FROM ('2000-11-14') TO ('2021-11-14') INTERVAL 2 YEAR)\"\n         )\n+        self.validate_identity(\"CREATE TABLE test_table (c1 INT, c2 DATE) PARTITION BY (c2)\")\n+        self.validate_identity(\"CREATE TABLE test_table (c1 INT, c2 DATE) PARTITION BY (c1, c2)\")\n+        self.validate_identity(\n+            \"CREATE TABLE test_table (c1 INT, c2 DATE) PARTITION BY (DATE_TRUNC(c2, 'MONTH'))\"\n+        )\n \n     def test_table_alias_conversion(self):\n         \"\"\"Test conversion from postgres to Doris for DELETE/UPDATE statements with table aliases.\"\"\"\n"
        }
    ]
}
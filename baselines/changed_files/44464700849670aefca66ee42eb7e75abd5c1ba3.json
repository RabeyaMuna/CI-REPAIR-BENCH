{
    "sha_fail": "44464700849670aefca66ee42eb7e75abd5c1ba3",
    "changed_files": [
        {
            "commit": "44464700849670aefca66ee42eb7e75abd5c1ba3",
            "file_path": "recipes/nzz_ger.recipe",
            "diff": "diff --git a/recipes/nzz_ger.recipe b/recipes/nzz_ger.recipe\nindex b48cd639..a0d82350 100644\n--- a/recipes/nzz_ger.recipe\n+++ b/recipes/nzz_ger.recipe\n@@ -29,10 +29,16 @@ class Nzz(BasicNewsRecipe):\n     remove_tags = [\n         dict(name='div', attrs={'class': 'progressbar__wrapper'}),               # Reading progress.\n         dict(name='div', attrs={'class': 'headline__meta'}),                     # Article meta data.\n-        dict(name='div', attrs={'class': 'nzzinteraction'}),\n-        dict(name='section', attrs={'class': 'nzzinteraction'}),\n         dict(name='span', attrs={'class': 'image-description__author-single'}),  # Photo accreditation.\n+        dict(name='span', attrs={'data-nzz-tid': 'image-description-author'}),   # Photo accreditation.\n         dict(name='div', attrs={'class': 'disabled-overlay'}),                   # \"Please enable Javascript\".\n+        dict(name='section', attrs={'id': 'content-table'}),                     # Table of contents.\n+        dict(name='div', attrs={'componenttype': 'articlelist'}),                # Article list inside the article.\n+    ]\n+\n+    remove_tags_after = [\n+        dict(name='p', attrs={'data-vars-danzz-last-article-element': 'true', 'class': 'articlecomponent'}),\n+        dict(name='div', attrs={'componenttype': 'sharebox'}),  # Remove everything after the social media share box.\n     ]\n \n     # Center and reduce the size of images and image captions.\n@@ -44,7 +50,6 @@ class Nzz(BasicNewsRecipe):\n     remove_attributes = ['style', 'font', 'class']\n \n     feeds = [\n-        ('Neueste Artikel', 'https://www.nzz.ch/recent.rss'),\n         ('Topthemen der Startseite', 'https://www.nzz.ch/startseite.rss'),\n         ('International', 'https://www.nzz.ch/international.rss'),\n         ('Schweiz', 'https://www.nzz.ch/schweiz.rss'),\n@@ -114,12 +119,34 @@ def get_browser(self, *args, **kwargs):\n         return br\n \n     def preprocess_html(self, soup):\n-        # Fix lazy-loading images\n+        # Fix lazy-loading images.\n         for img in soup.findAll('img', attrs={'srcset': True}):\n             img['src'] = img['srcset'].split()[0]\n \n         # To prevent image captions from being displayed as headers in the output, convert them from <h2> to <p>.\n-        for caption in soup.findAll('h2', attrs={'class': 'image-description__caption'}):\n+        for caption in soup.findAll('h2', attrs={'data-nzz-tid': 'image-description-caption'}):\n             caption.name = 'p'\n \n+        # Remove the article metadata block.\n+        # First, find the first <hr> tag.\n+        hr_tag = soup.find('hr')\n+        if hr_tag:\n+            self.log.debug(f\"Found <hr> tag: {hr_tag}\")\n+            # Then, if the next direct sibling after the `hr_tag` is a <div> of class \"mx-auto\", \"items-start\",\n+            # \"justify-between\" and \"text-left\", remove that <div>, as it is the metadata block.\n+            next_sibling = hr_tag.find_next_sibling()\n+            if next_sibling and next_sibling.name == 'div':\n+                 self.log.debug(f\"Found next sibling <div>: {next_sibling}\")\n+                 next_sibling_classes = next_sibling.get('class', [])\n+                 if all(c in next_sibling_classes for c in ['items-start', 'justify-between', 'text-left']):\n+                    self.log.debug(\"Removing the article metadata block.\")\n+                    next_sibling.decompose()\n+\n+        # Remove the social media share box, which should delimit the end of the article.\n+        sharebox_div = soup.find('div', attrs={'componenttype': 'sharebox'})\n+        self.log.debug(f\"Searching for sharebox <div> with attrs {{'componenttype': 'sharebox'}}.\")\n+        if sharebox_div:\n+            self.log.debug(f\"Found sharebox <div> that will now be removed.\")\n+            sharebox_div.decompose()\n+\n         return soup\n"
        }
    ]
}
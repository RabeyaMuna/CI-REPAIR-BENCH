{
    "sha_fail": "55d2e8d4abb024997be878797d5625effad65d43",
    "changed_files": [
        {
            "commit": "55d2e8d4abb024997be878797d5625effad65d43",
            "file_path": "tests/unittests/test_net_activators.py",
            "diff": "diff --git a/tests/unittests/test_net_activators.py b/tests/unittests/test_net_activators.py\nindex 2a363ec4..0b3c11c1 100644\n--- a/tests/unittests/test_net_activators.py\n+++ b/tests/unittests/test_net_activators.py\n@@ -1,3 +1,4 @@\n+import os\n from collections import namedtuple\n from contextlib import ExitStack\n from unittest.mock import patch\n@@ -322,3 +323,97 @@ class TestActivatorsBringDown:\n         activator.bring_down_interface(\"eth0\")\n         assert len(m_subp.call_args_list) == 1\n         assert m_subp.call_args_list[0] == expected_call_list[0]\n+\n+\n+class TestNetworkManagerActivatorBringUp:\n+    def fake_isfile_no_nmconn(filename):\n+        return False if filename.endswith(\".nmconnection\") else True\n+\n+    @patch(\"cloudinit.subp.subp\", return_value=(\"\", \"\"))\n+    @patch(\n+        \"cloudinit.net.network_manager.available_nm_ifcfg_rh\",\n+        return_value=True,\n+    )\n+    @patch.object(os.path, \"isfile\", side_effect=fake_isfile_no_nmconn)\n+    @patch(\"os.path.exists\", return_value=True)\n+    def test_bring_up_interface_no_nm_conn(\n+        self, m_exists, m_isfile, m_plugin, m_subp\n+    ):\n+        \"\"\"\n+        There is no network manager connection file but ifcfg-rh plugin is\n+        present and ifcfg interface config files are also present. In this\n+        case, we should use ifcfg files.\n+        \"\"\"\n+        expected_call_list = [\n+            (\n+                (\n+                    [\n+                        \"nmcli\",\n+                        \"connection\",\n+                        \"load\",\n+                        \"\".join(\n+                            [\n+                                \"/etc/sysconfig/network-scripts/ifcfg-eth0\",\n+                            ]\n+                        ),\n+                    ],\n+                ),\n+                {},\n+            ),\n+            (\n+                (\n+                    [\n+                        \"nmcli\",\n+                        \"connection\",\n+                        \"up\",\n+                        \"filename\",\n+                        \"\".join(\n+                            [\n+                                \"/etc/sysconfig/network-scripts/ifcfg-eth0\",\n+                            ]\n+                        ),\n+                    ],\n+                ),\n+                {},\n+            ),\n+        ]\n+        index = 0\n+        assert NetworkManagerActivator.bring_up_interface(\"eth0\")\n+        for call in m_subp.call_args_list:\n+            assert call == expected_call_list[index]\n+            index += 1\n+\n+    @patch(\"cloudinit.subp.subp\", return_value=(\"\", \"\"))\n+    @patch(\n+        \"cloudinit.net.network_manager.available_nm_ifcfg_rh\",\n+        return_value=False,\n+    )\n+    @patch.object(os.path, \"isfile\", side_effect=fake_isfile_no_nmconn)\n+    @patch(\"os.path.exists\", return_value=True)\n+    def test_bring_up_interface_no_plugin_no_nm_conn(\n+        self, m_exists, m_isfile, m_plugin, m_subp\n+    ):\n+        \"\"\"\n+        The ifcfg-rh plugin is absent and nmconnection file is also\n+        not present. In this case, we can't use ifcfg file and the\n+        interface bring up should fail.\n+        \"\"\"\n+        assert not NetworkManagerActivator.bring_up_interface(\"eth0\")\n+\n+    @patch(\"cloudinit.subp.subp\", return_value=(\"\", \"\"))\n+    @patch(\n+        \"cloudinit.net.network_manager.available_nm_ifcfg_rh\",\n+        return_value=True,\n+    )\n+    @patch(\"os.path.isfile\", return_value=False)\n+    @patch(\"os.path.exists\", return_value=True)\n+    def test_bring_up_interface_no_conn_file(\n+        self, m_exists, m_isfile, m_plugin, m_subp\n+    ):\n+        \"\"\"\n+        Neither network manager connection files are present nor\n+        ifcfg files are present. Even if ifcfg-rh plugin is present,\n+        we can not bring up the interface. So bring_up_interface()\n+        should fail.\n+        \"\"\"\n+        assert not NetworkManagerActivator.bring_up_interface(\"eth0\")\n"
        }
    ]
}
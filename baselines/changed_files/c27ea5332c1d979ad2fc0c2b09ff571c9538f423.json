{
    "sha_fail": "c27ea5332c1d979ad2fc0c2b09ff571c9538f423",
    "changed_files": [
        {
            "commit": "c27ea5332c1d979ad2fc0c2b09ff571c9538f423",
            "file_path": "libs/agno/agno/agent/agent.py",
            "diff": "diff --git a/libs/agno/agno/agent/agent.py b/libs/agno/agno/agent/agent.py\nindex 883462662..3e2ac9bb2 100644\n--- a/libs/agno/agno/agent/agent.py\n+++ b/libs/agno/agno/agent/agent.py\n@@ -4690,7 +4690,10 @@ class Agent:\n                 )\n             elif isinstance(self.memory, Memory):\n                 history = self.memory.get_messages_from_last_n_runs(\n-                    session_id=session_id, last_n=self.num_history_runs, skip_role=self.system_message_role\n+                    session_id=session_id,\n+                    last_n=self.num_history_runs,\n+                    skip_role=self.system_message_role,\n+                    agent_id=self.agent_id,\n                 )\n \n             if len(history) > 0:\n@@ -4820,7 +4823,10 @@ class Agent:\n                 )\n             elif isinstance(self.memory, Memory):\n                 history = self.memory.get_messages_from_last_n_runs(\n-                    session_id=session_id, last_n=self.num_history_runs, skip_role=self.system_message_role\n+                    session_id=session_id,\n+                    last_n=self.num_history_runs,\n+                    skip_role=self.system_message_role,\n+                    agent_id=self.agent_id,\n                 )\n             if len(history) > 0:\n                 # Create a deep copy of the history messages to avoid modifying the original messages\n@@ -5515,7 +5521,7 @@ class Agent:\n         if isinstance(self.memory, AgentMemory):\n             return self.memory.messages\n         elif isinstance(self.memory, Memory):\n-            return self.memory.get_messages_from_last_n_runs(session_id=_session_id)\n+            return self.memory.get_messages_from_last_n_runs(session_id=_session_id, agent_id=self.agent_id)\n         else:\n             return []\n \n"
        },
        {
            "commit": "c27ea5332c1d979ad2fc0c2b09ff571c9538f423",
            "file_path": "libs/agno/agno/memory/v2/memory.py",
            "diff": "diff --git a/libs/agno/agno/memory/v2/memory.py b/libs/agno/agno/memory/v2/memory.py\nindex a32aec872..2929761c9 100644\n--- a/libs/agno/agno/memory/v2/memory.py\n+++ b/libs/agno/agno/memory/v2/memory.py\n@@ -692,6 +692,8 @@ class Memory:\n     def get_messages_from_last_n_runs(\n         self,\n         session_id: str,\n+        agent_id: Optional[str] = None,\n+        team_id: Optional[str] = None,\n         last_n: Optional[int] = None,\n         skip_role: Optional[str] = None,\n         skip_history_messages: bool = True,\n@@ -699,6 +701,8 @@ class Memory:\n         \"\"\"Returns the messages from the last_n runs, excluding previously tagged history messages.\n         Args:\n             session_id: The session id to get the messages from.\n+            agent_id: The id of the agent to get the messages from.\n+            team_id: The id of the team to get the messages from.\n             last_n: The number of runs to return from the end of the conversation. Defaults to all runs.\n             skip_role: Skip messages with this role.\n             skip_history_messages: Skip messages that were tagged as history in previous runs.\n@@ -709,6 +713,10 @@ class Memory:\n             return []\n \n         session_runs = self.runs.get(session_id, [])\n+        if agent_id:\n+            session_runs = [run for run in session_runs if hasattr(run, \"agent_id\") and run.agent_id == agent_id]  # type: ignore\n+        if team_id:\n+            session_runs = [run for run in session_runs if hasattr(run, \"team_id\") and run.team_id == team_id]  # type: ignore\n         runs_to_process = session_runs[-last_n:] if last_n is not None else session_runs\n         messages_from_history = []\n         system_message = None\n"
        },
        {
            "commit": "c27ea5332c1d979ad2fc0c2b09ff571c9538f423",
            "file_path": "libs/agno/agno/team/team.py",
            "diff": "diff --git a/libs/agno/agno/team/team.py b/libs/agno/agno/team/team.py\nindex c92fcbcdc..6d0f4579e 100644\n--- a/libs/agno/agno/team/team.py\n+++ b/libs/agno/agno/team/team.py\n@@ -4474,7 +4474,7 @@ class Team:\n                 session_id=session_id,\n                 stream=self.stream or False,\n                 stream_intermediate_steps=self.stream_intermediate_steps,\n-                async_mode=False,\n+                async_mode=async_mode,\n                 images=images,  # type: ignore\n                 videos=videos,  # type: ignore\n                 audio=audio,  # type: ignore\n@@ -4492,7 +4492,7 @@ class Team:\n                     user_id=user_id,\n                     stream=self.stream or False,\n                     stream_intermediate_steps=self.stream_intermediate_steps,\n-                    async_mode=False,\n+                    async_mode=async_mode,\n                     images=images,  # type: ignore\n                     videos=videos,  # type: ignore\n                     audio=audio,  # type: ignore\n@@ -4509,7 +4509,7 @@ class Team:\n                 user_id=user_id,\n                 stream=self.stream or False,\n                 stream_intermediate_steps=self.stream_intermediate_steps,\n-                async_mode=False,\n+                async_mode=async_mode,\n                 images=images,  # type: ignore\n                 videos=videos,  # type: ignore\n                 audio=audio,  # type: ignore\n@@ -4945,7 +4945,10 @@ class Team:\n                 )\n             elif isinstance(self.memory, Memory):\n                 history = self.memory.get_messages_from_last_n_runs(\n-                    session_id=session_id, last_n=self.num_history_runs, skip_role=self.system_message_role\n+                    session_id=session_id,\n+                    last_n=self.num_history_runs,\n+                    skip_role=self.system_message_role,\n+                    team_id=self.team_id,\n                 )\n \n             if len(history) > 0:\n@@ -6621,7 +6624,6 @@ class Team:\n     ) -> List[Message]:\n         \"\"\"Get messages for a session\"\"\"\n         _session_id = session_id or self.session_id\n-        _user_id = user_id or self.user_id\n         if _session_id is None:\n             log_warning(\"Session ID is not set, cannot get messages for session\")\n             return []\n@@ -6635,7 +6637,7 @@ class Team:\n         if isinstance(self.memory, AgentMemory):\n             return self.memory.messages\n         elif isinstance(self.memory, Memory):\n-            return self.memory.get_messages_from_last_n_runs(session_id=_session_id)\n+            return self.memory.get_messages_from_last_n_runs(session_id=_session_id, team_id=self.team_id)\n         else:\n             return []\n \n"
        },
        {
            "commit": "c27ea5332c1d979ad2fc0c2b09ff571c9538f423",
            "file_path": "libs/agno/agno/utils/json_schema.py",
            "diff": "diff --git a/libs/agno/agno/utils/json_schema.py b/libs/agno/agno/utils/json_schema.py\nindex aac1271d7..31692e9f0 100644\n--- a/libs/agno/agno/utils/json_schema.py\n+++ b/libs/agno/agno/utils/json_schema.py\n@@ -141,11 +141,17 @@ def get_json_schema_for_arg(type_hint: Any) -> Optional[Dict[str, Any]]:\n                     continue\n             return {\"anyOf\": types} if types else None\n \n-    elif issubclass(type_hint, BaseModel):\n+\n+    if isinstance(type_hint, type) and issubclass(type_hint, Enum):\n+        enum_values = [member.value for member in type_hint]\n+        return {\"type\": \"string\", \"enum\": enum_values}\n+    \n+    if isinstance(type_hint, type) and issubclass(type_hint, BaseModel):\n         # Get the schema and inline it\n         schema = type_hint.model_json_schema()\n         return inline_pydantic_schema(schema)  # type: ignore\n-    elif hasattr(type_hint, \"__dataclass_fields__\"):\n+    \n+    if hasattr(type_hint, \"__dataclass_fields__\"):\n         # Convert dataclass to JSON schema\n         properties = {}\n         required = []\n@@ -175,10 +181,6 @@ def get_json_schema_for_arg(type_hint: Any) -> Optional[Dict[str, Any]]:\n             arg_json_schema[\"required\"] = required\n         return arg_json_schema\n \n-    if issubclass(type_hint, Enum):\n-        enum_values = [member.value for member in type_hint]\n-        return {\"type\": \"string\", \"enum\": enum_values}\n-\n     json_schema: Dict[str, Any] = {\"type\": get_json_type_for_py_type(type_hint.__name__)}\n     if json_schema[\"type\"] == \"object\":\n         json_schema[\"properties\"] = {}\n"
        },
        {
            "commit": "c27ea5332c1d979ad2fc0c2b09ff571c9538f423",
            "file_path": "libs/agno/tests/integration/knowledge/test_website_knowledge_base.py",
            "diff": "diff --git a/libs/agno/tests/integration/knowledge/test_website_knowledge_base.py b/libs/agno/tests/integration/knowledge/test_website_knowledge_base.py\nindex 94c735813..174e4f0b2 100644\n--- a/libs/agno/tests/integration/knowledge/test_website_knowledge_base.py\n+++ b/libs/agno/tests/integration/knowledge/test_website_knowledge_base.py\n@@ -25,7 +25,7 @@ def test_website_knowledge_base_directory(setup_vector_db):\n     kb.load(recreate=True)\n \n     assert setup_vector_db.exists()\n-    assert setup_vector_db.get_count() == 4\n+    assert setup_vector_db.get_count() == 3\n \n     agent = Agent(knowledge=kb)\n     response = agent.run(\"What are agents in Agno and what levels are there?\", markdown=True)\n"
        }
    ]
}
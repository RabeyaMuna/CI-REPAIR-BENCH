{
    "sha_fail": "0d26cc1482ff5080ec579b17b29f22657a20c562",
    "changed_files": [
        {
            "commit": "0d26cc1482ff5080ec579b17b29f22657a20c562",
            "file_path": "beetsplug/edit.py",
            "diff": "diff --git a/beetsplug/edit.py b/beetsplug/edit.py\nindex b6ae2ba4..8a07fcca 100644\n--- a/beetsplug/edit.py\n+++ b/beetsplug/edit.py\n@@ -155,14 +155,11 @@ class EditPlugin(plugins.BeetsPlugin):\n             }\n         )\n \n-        self.readonly_fields = {}\n+        self.has_shown_ui = False\n \n         self.register_listener(\n             \"before_choose_candidate\", self.before_choose_candidate_listener\n         )\n-        self.register_listener(\n-            \"import_begin\", self.import_begin_listener\n-        )\n \n     def commands(self):\n         edit_command = ui.Subcommand(\"edit\", help=\"interactively edit metadata\")\n@@ -242,13 +239,14 @@ class EditPlugin(plugins.BeetsPlugin):\n         old_data = [flatten(o, fields) for o in objs]\n \n         # take set fields into account\n-        if self.readonly_fields:\n-            old_str = \"# note: the following fields will be reset to their current values:\\n\"\n-            for key in self.readonly_fields:\n+        set_fields = config[\"import\"][\"set_fields\"]\n+        if set_fields and not self.has_shown_ui:\n+            old_str = \"\\n\\n# note: the following fields will be reset to their current values:\\n\"\n+            for key in set_fields:\n                 old_str += f\"# - {key}\\n\"\n             for obj in old_data:\n                 # those values will be enforced later anyway\n-                obj.update(self.readonly_fields)\n+                obj.update({k:v.get() for k,v in set_fields.items()})\n         else:\n             old_str = \"\"\n \n@@ -256,7 +254,7 @@ class EditPlugin(plugins.BeetsPlugin):\n         new = NamedTemporaryFile(\n             mode=\"w\", suffix=\".yaml\", delete=False, encoding=\"utf-8\"\n         )\n-        old_str += dump(old_data)\n+        old_str = dump(old_data) + old_str\n         new.write(old_str)\n         new.close()\n \n@@ -265,6 +263,7 @@ class EditPlugin(plugins.BeetsPlugin):\n             while True:\n                 # Ask the user to edit the data.\n                 edit(new.name, self._log)\n+                self.has_shown_ui = True\n \n                 # Read the data back after editing and check whether anything\n                 # changed.\n@@ -374,12 +373,6 @@ class EditPlugin(plugins.BeetsPlugin):\n \n         return choices\n \n-    def import_begin_listener(self, session):\n-        \"\"\"Load data from import session into self\"\"\"\n-        self.readonly_fields = {}\n-        for field, view in config[\"import\"][\"set_fields\"].items():\n-            self.readonly_fields[field] = view.get()\n-\n     def importer_edit(self, session, task):\n         \"\"\"Callback for invoking the functionality during an interactive\n         import session on the *original* item tags.\n"
        }
    ]
}
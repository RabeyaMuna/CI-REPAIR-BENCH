{
    "sha_fail": "6e5f3fc6534025b5711d84f144d3071f1ff403d2",
    "changed_files": [
        {
            "commit": "6e5f3fc6534025b5711d84f144d3071f1ff403d2",
            "file_path": "cookbook/tools/daytona_tools.py",
            "diff": "diff --git a/cookbook/tools/daytona_tools.py b/cookbook/tools/daytona_tools.py\nnew file mode 100644\nindex 000000000..8babc66bb\n--- /dev/null\n+++ b/cookbook/tools/daytona_tools.py\n@@ -0,0 +1,52 @@\n+\"\"\"\n+\ud83d\udc69\u200d\ud83d\udcbb Agent with Daytona tools\n+\n+This example shows how to use Agno's Daytona integration to run Agent-generated code in a remote, secure sandbox.\n+\n+1. Get your Daytona API key and API URL: https://app.daytona.io/dashboard/keys\n+2. Set the API key and API URL as environment variables:\n+    export DAYTONA_API_KEY=<your_api_key>\n+    export DAYTONA_API_URL=<your_api_url>\n+3. Install the dependencies:\n+    pip install agno anthropic daytona_sdk\n+\"\"\"\n+\n+from agno.agent import Agent\n+from agno.models.anthropic import Claude\n+from agno.tools.daytona import DaytonaTools\n+\n+daytona_tools = DaytonaTools()\n+\n+# Setup an Agent focused on coding tasks, with access to the Daytona tools\n+agent = Agent(\n+    name=\"Coding Agent with Daytona tools\",\n+    agent_id=\"coding-agent\",\n+    model=Claude(id=\"claude-3-7-sonnet-latest\"),\n+    tools=[daytona_tools],\n+    markdown=True,\n+    show_tool_calls=True,\n+    instructions=[\n+        \"You are an expert at writing and validating Python code. You have access to a remote, secure Daytona sandbox.\",\n+        \"Your primary purpose is to:\",\n+        \"1. Write clear, efficient Python code based on user requests\",\n+        \"2. Execute and verify the code in the Daytona sandbox\",\n+        \"3. Share the complete code with the user, as this is the main use case\",\n+        \"4. Provide thorough explanations of how the code works\",\n+        \"You can use the run_python_code tool to run Python code in the Daytona sandbox.\",\n+        \"Guidelines:\",\n+        \"- ALWAYS share the complete code with the user, properly formatted in code blocks\",\n+        \"- Verify code functionality by executing it in the sandbox before sharing\",\n+        \"- Iterate and debug code as needed to ensure it works correctly\",\n+        \"- Use pandas, matplotlib, and other Python libraries for data analysis when appropriate\",\n+        \"- Create proper visualizations when requested and add them as image artifacts to show inline\",\n+        \"- Handle file uploads and downloads properly\",\n+        \"- Explain your approach and the code's functionality in detail\",\n+        \"- Format responses with both code and explanations for maximum clarity\",\n+        \"- Handle errors gracefully and explain any issues encountered\",\n+    ],\n+)\n+\n+\n+agent.print_response(\n+    \"Write Python code to generate the first 10 Fibonacci numbers and calculate their sum and average\"\n+)\n"
        },
        {
            "commit": "6e5f3fc6534025b5711d84f144d3071f1ff403d2",
            "file_path": "libs/agno/agno/tools/daytona.py",
            "diff": "diff --git a/libs/agno/agno/tools/daytona.py b/libs/agno/agno/tools/daytona.py\nnew file mode 100644\nindex 000000000..0b0a2b0a7\n--- /dev/null\n+++ b/libs/agno/agno/tools/daytona.py\n@@ -0,0 +1,134 @@\n+import json\n+from os import getenv\n+from typing import Any, Dict, List, Optional\n+\n+from daytona_sdk import Daytona\n+\n+from agno.tools import Toolkit\n+from agno.utils.code_execution import prepare_python_code\n+from agno.utils.log import logger\n+\n+try:\n+    from daytona_sdk import (\n+        CodeLanguage,\n+        CreateSandboxParams,\n+        DaytonaConfig,\n+        Sandbox,\n+        SandboxTargetRegion,\n+    )\n+    from daytona_sdk.common.process import ExecuteResponse\n+except ImportError:\n+    raise ImportError(\"`daytona_sdk` not installed. Please install using `pip install daytona_sdk`\")\n+\n+\n+class DaytonaTools(Toolkit):\n+    def __init__(\n+        self,\n+        api_key: Optional[str] = None,\n+        api_url: Optional[str] = None,\n+        sandbox_language: Optional[CodeLanguage] = None,\n+        sandbox_target_region: Optional[SandboxTargetRegion] = None,\n+        sandbox_os: Optional[str] = None,\n+        sandbox_os_user: Optional[str] = None,\n+        sandbox_env_vars: Optional[Dict[str, str]] = None,\n+        sandbox_labels: Optional[Dict[str, str]] = None,\n+        sandbox_public: Optional[bool] = None,\n+        sandbox_auto_stop_interval: Optional[int] = None,\n+        organization_id: Optional[str] = None,\n+        timeout: int = 300,  # 5 minutes default timeout\n+        **kwargs,\n+    ):\n+        \"\"\"Initialize Daytona Toolkit, useful for remote code execution.\n+\n+        Args:\n+            api_key: Daytona API key (defaults to DAYTONA_API_KEY environment variable)\n+            api_url: Daytona API URL (defaults to DAYTONA_API_URL environment variable)\n+            sandbox_language: The programming language to run on the sandbox (default: python)\n+            sandbox_target_region: The region where the sandbox will be created\n+            sandbox_os: The operating system to run on the sandbox (default: ubuntu)\n+            sandbox_os_user: The user to run the sandbox as (default: root)\n+            sandbox_env_vars: The environment variables to set in the sandbox\n+            sandbox_labels: The labels to set in the sandbox\n+            sandbox_public: Whether the sandbox should be public\n+            sandbox_auto_stop_interval: The interval in minutes after which the sandbox will be stopped if no activity occurs\n+            organization_id: The contextual Daytona organization ID for the sandbox\n+            timeout: Timeout in seconds for communication with the sandbox (default: 5 minutes)\n+        \"\"\"\n+\n+        self.api_key = api_key or getenv(\"DAYTONA_API_KEY\")\n+        if not self.api_key:\n+            raise ValueError(\"DAYTONA_API_KEY not set. Please set the DAYTONA_API_KEY environment variable.\")\n+\n+        self.api_url = api_url or getenv(\"DAYTONA_API_URL\")\n+        if not self.api_url:\n+            raise ValueError(\"DAYTONA_API_URL not set. Please set the DAYTONA_API_URL environment variable.\")\n+\n+        self.sandbox_target_region = sandbox_target_region\n+        self.organization_id = organization_id\n+        self.sandbox_language = sandbox_language\n+        self.sandbox_os = sandbox_os\n+        self.sandbox_os_user = sandbox_os_user\n+        self.sandbox_env_vars = sandbox_env_vars\n+        self.sandbox_labels = sandbox_labels\n+        self.sandbox_public = sandbox_public\n+        self.sandbox_auto_stop_interval = sandbox_auto_stop_interval\n+        self.timeout = timeout\n+\n+        self.config = DaytonaConfig(\n+            api_key=self.api_key,\n+            api_url=self.api_url,\n+            target=self.sandbox_target_region,\n+            organization_id=self.organization_id,\n+        )  # type: ignore\n+\n+        try:\n+            params = CreateSandboxParams(\n+                language=self.sandbox_language,\n+                os_user=self.sandbox_os_user,\n+                env_vars=self.sandbox_env_vars,\n+                labels=self.sandbox_labels,\n+                public=self.sandbox_public,\n+                auto_stop_interval=self.sandbox_auto_stop_interval,\n+                timeout=self.timeout,\n+            )\n+            daytona = Daytona(self.config)\n+            self.sandbox: Sandbox = daytona.create(params)\n+        except Exception as e:\n+            logger.error(f\"Error creating Daytona sandbox: {e}\")\n+            raise e\n+\n+        # Last execution result for reference\n+        self.last_execution: Optional[ExecuteResponse] = None\n+\n+        tools: List[Any] = []\n+\n+        if self.sandbox_language == CodeLanguage.PYTHON:\n+            tools.append(self.run_python_code)\n+        else:\n+            tools.append(self.run_code)\n+\n+        super().__init__(name=\"daytona_tools\", tools=tools, **kwargs)\n+\n+    def run_python_code(self, code: str) -> str:\n+        \"\"\"Prepare and run Python code in the contextual Daytona sandbox.\"\"\"\n+        try:\n+            executable_code = prepare_python_code(code)\n+\n+            execution = self.sandbox.process.code_run(executable_code)\n+\n+            self.last_execution = execution\n+            self.result: str = execution.result\n+            return self.result\n+        except Exception as e:\n+            return json.dumps({\"status\": \"error\", \"message\": f\"Error executing code: {str(e)}\"})\n+\n+    def run_code(self, code: str) -> str:\n+        \"\"\"General function to run non-Python code in the contextual Daytona sandbox.\"\"\"\n+        try:\n+            response = self.sandbox.process.code_run(code)\n+\n+            self.last_execution = response\n+            self.result: str = response.result\n+            return self.result\n+        except Exception as e:\n+            return json.dumps({\"status\": \"error\", \"message\": f\"Error executing code: {str(e)}\"})\n"
        },
        {
            "commit": "6e5f3fc6534025b5711d84f144d3071f1ff403d2",
            "file_path": "libs/agno/agno/tools/e2b.py",
            "diff": "diff --git a/libs/agno/agno/tools/e2b.py b/libs/agno/agno/tools/e2b.py\nindex 3809c9217..184979b55 100644\n--- a/libs/agno/agno/tools/e2b.py\n+++ b/libs/agno/agno/tools/e2b.py\n@@ -1,6 +1,5 @@\n import base64\n import json\n-import re\n import tempfile\n import time\n from os import fdopen, getenv\n@@ -12,6 +11,7 @@ from agno.agent import Agent\n from agno.media import ImageArtifact\n from agno.team.team import Team\n from agno.tools import Toolkit\n+from agno.utils.code_execution import prepare_python_code\n from agno.utils.log import logger\n \n try:\n@@ -102,16 +102,9 @@ class E2BTools(Toolkit):\n             str: Execution results or error message\n         \"\"\"\n         try:\n-            # Execute the code in the sandbox using the correct method name for Python SDK\n-            # Fix common Python keywords that require capitalized first letters\n-            # This is necessary because users or LLMs sometimes use lowercase versions\n-            # of Python keywords that should be capitalized (True, False, None)\n-            python_keywords = {\"true\": \"True\", \"false\": \"False\", \"none\": \"None\"}\n+            executable_code = prepare_python_code(code)\n \n-            for lowercase, capitalized in python_keywords.items():\n-                code = re.sub(rf\"\\b({lowercase})\\b\", capitalized, code)\n-\n-            execution = self.sandbox.run_code(code)\n+            execution = self.sandbox.run_code(executable_code)\n             self.last_execution = execution\n \n             # Check for errors\n"
        },
        {
            "commit": "6e5f3fc6534025b5711d84f144d3071f1ff403d2",
            "file_path": "libs/agno/agno/utils/code_execution.py",
            "diff": "diff --git a/libs/agno/agno/utils/code_execution.py b/libs/agno/agno/utils/code_execution.py\nnew file mode 100644\nindex 000000000..f62121bea\n--- /dev/null\n+++ b/libs/agno/agno/utils/code_execution.py\n@@ -0,0 +1,11 @@\n+\"\"\"Utils for our multiple integrations with external code execution environments.\"\"\"\n+\n+import re\n+\n+\n+def prepare_python_code(code: str) -> str:\n+    \"\"\"Fix common problems with LLM-generated Python code.\"\"\"\n+    python_keywords = {\"true\": \"True\", \"false\": \"False\", \"none\": \"None\"}\n+    for lowercase, capitalized in python_keywords.items():\n+        code = re.sub(rf\"\\b({lowercase})\\b\", capitalized, code)\n+    return code\n"
        }
    ]
}
{
    "sha_fail": "dadeba110a5a98dbc810f9b8f3896424175318c1",
    "changed_files": [
        {
            "commit": "dadeba110a5a98dbc810f9b8f3896424175318c1",
            "file_path": "AUTHORS",
            "diff": "diff --git a/AUTHORS b/AUTHORS\nindex 3517471..9866bd6 100644\n--- a/AUTHORS\n+++ b/AUTHORS\n@@ -163,4 +163,5 @@ The following is a list of much appreciated contributors:\n * rodolvbg (Rodolfo Becerra)\n * Andy Zickler\n * kuldeepkhatke (Kuldeep Khatke)\n-* siddharth1012 (Siddharth Saraswat)\n\\ No newline at end of file\n+* siddharth1012 (Siddharth Saraswat)\n+* borisovodov (Boris Ovodov)\n\\ No newline at end of file\n"
        },
        {
            "commit": "dadeba110a5a98dbc810f9b8f3896424175318c1",
            "file_path": "import_export/admin.py",
            "diff": "diff --git a/import_export/admin.py b/import_export/admin.py\nindex e1a0dc5..042aa09 100644\n--- a/import_export/admin.py\n+++ b/import_export/admin.py\n@@ -198,6 +198,12 @@ class ImportMixin(BaseImportMixin, ImportExportMixinBase):\n         request,\n         **kwargs,\n     ):\n+        # Get file_name from kwargs if provided, otherwise from form's cleaned_data\n+        # Must be extracted before passing kwargs to get_import_data_kwargs\n+        file_name = kwargs.pop(\"file_name\", None)\n+        if file_name is None:\n+            file_name = form.cleaned_data.get(\"original_file_name\")\n+\n         res_kwargs = self.get_import_resource_kwargs(request, form=form, **kwargs)\n         resource = self.choose_import_resource_class(form, request)(**res_kwargs)\n         imp_kwargs = self.get_import_data_kwargs(request=request, form=form, **kwargs)\n@@ -206,7 +212,7 @@ class ImportMixin(BaseImportMixin, ImportExportMixinBase):\n         return resource.import_data(\n             dataset,\n             dry_run=False,\n-            file_name=form.cleaned_data.get(\"original_file_name\"),\n+            file_name=file_name,\n             user=request.user,\n             **imp_kwargs,\n         )\n@@ -470,6 +476,7 @@ class ImportMixin(BaseImportMixin, ImportExportMixinBase):\n                         request,\n                         raise_errors=False,\n                         rollback_on_validation_errors=True,\n+                        file_name=import_file.name,\n                         **kwargs,\n                     )\n                     if not result.has_errors() and not result.has_validation_errors():\n"
        },
        {
            "commit": "dadeba110a5a98dbc810f9b8f3896424175318c1",
            "file_path": "tests/core/tests/admin_integration/test_import_functionality.py",
            "diff": "diff --git a/tests/core/tests/admin_integration/test_import_functionality.py b/tests/core/tests/admin_integration/test_import_functionality.py\nindex cbe0409..c313bb7 100644\n--- a/tests/core/tests/admin_integration/test_import_functionality.py\n+++ b/tests/core/tests/admin_integration/test_import_functionality.py\n@@ -15,6 +15,21 @@ from import_export.formats import base_formats\n from import_export.resources import ModelResource\n \n \n+class BookResourceWithFileNameTracking(ModelResource):\n+    \"\"\"Resource for tracking file_name in before_import_row\"\"\"\n+\n+    def __init__(self, **kwargs):\n+        self.file_names = []\n+        super().__init__(**kwargs)\n+\n+    def before_import_row(self, row, **kwargs):\n+        file_name = kwargs.get(\"file_name\")\n+        self.file_names.append(file_name)\n+\n+    class Meta:\n+        model = Book\n+\n+\n class ImportAdminIntegrationTest(AdminTestMixin, TestCase):\n \n     @patch(\n@@ -32,6 +47,63 @@ class ImportAdminIntegrationTest(AdminTestMixin, TestCase):\n             ).format(1, 0, 0, 0, Book._meta.verbose_name_plural),\n         )\n \n+    @patch(\n+        \"core.admin.BookAdmin.skip_import_confirm\",\n+        new_callable=PropertyMock,\n+        return_value=True,\n+    )\n+    def test_file_name_passed_to_before_import_row_with_skip_confirm(\n+        self, mock_skip_import_confirm\n+    ):\n+        \"\"\"\n+        Test that file_name is passed to before_import_row\n+        when skip_import_confirm=True.\n+\n+        This is a regression test for an issue where file_name was None in\n+        before_import_row when skip_import_confirm was True, but was correctly\n+        set when skip_import_confirm was False.\n+        \"\"\"\n+        from core.admin import BookResource\n+\n+        # Track calls to before_import_row\n+        file_names_captured = []\n+\n+        original_before_import_row = BookResource.before_import_row\n+\n+        def track_before_import_row(resource_self, row, **kwargs):\n+            file_names_captured.append(kwargs.get(\"file_name\"))\n+            return original_before_import_row(resource_self, row, **kwargs)\n+\n+        with patch.object(\n+            BookResource,\n+            \"before_import_row\",\n+            track_before_import_row,\n+        ):\n+            response = self._do_import_post(\n+                self.book_import_url, \"books.csv\", follow=True\n+            )\n+            self.assertEqual(response.status_code, 200)\n+            self.assertContains(\n+                response,\n+                _(\n+                    \"Import finished: {} new, {} updated, {} deleted and {} skipped {}.\"\n+                ).format(1, 0, 0, 0, Book._meta.verbose_name_plural),\n+            )\n+\n+            # Verify that file_name was passed to before_import_row\n+            self.assertTrue(\n+                len(file_names_captured) > 0,\n+                \"before_import_row should have been called\",\n+            )\n+            # Check that file_name is not None\n+            for file_name in file_names_captured:\n+                self.assertIsNotNone(\n+                    file_name,\n+                    \"file_name should not be None in before_import_row when \"\n+                    \"skip_import_confirm=True\",\n+                )\n+                self.assertEqual(file_name, \"books.csv\")\n+\n     def test_delete_from_admin(self):\n         # test delete from admin site (see #432)\n \n"
        }
    ]
}
{
    "sha_fail": "5d1b328545612a301cc57da123bcc7c34b547c4c",
    "changed_files": [
        {
            "commit": "5d1b328545612a301cc57da123bcc7c34b547c4c",
            "file_path": "celery/backends/redis.py",
            "diff": "diff --git a/celery/backends/redis.py b/celery/backends/redis.py\nindex cb77ba5..dc2fa56 100644\n--- a/celery/backends/redis.py\n+++ b/celery/backends/redis.py\n@@ -79,7 +79,6 @@ store backend. The Celery application must be restarted.\n \n logger = get_logger(__name__)\n \n-\n class ResultConsumer(BaseResultConsumer):\n     _pubsub = None\n \n"
        },
        {
            "commit": "5d1b328545612a301cc57da123bcc7c34b547c4c",
            "file_path": "t/unit/backends/test_redis.py",
            "diff": "diff --git a/t/unit/backends/test_redis.py b/t/unit/backends/test_redis.py\nindex f8a42d2..3cac9f4 100644\n--- a/t/unit/backends/test_redis.py\n+++ b/t/unit/backends/test_redis.py\n@@ -374,6 +374,10 @@ class MyCredentialProvider(CredentialProvider):\n     pass\n \n \n+class NonCredentialProvider:\n+    pass\n+\n+\n class test_RedisBackend(basetest_RedisBackend):\n     @pytest.mark.usefixtures('depends_on_current_app')\n     def test_reduce(self):\n@@ -418,6 +422,20 @@ class test_RedisBackend(basetest_RedisBackend):\n         assert 'username' not in x.connparams\n         assert 'password' not in x.connparams\n \n+        # raise ImportError\n+        self.app.conf.redis_backend_credential_provider = \"not_exist.CredentialProvider\"\n+        with pytest.raises(ImportError):\n+            x = self.Backend(app=self.app)\n+            assert x.connparams\n+            assert 'credential_provider' in x.connparams\n+\n+        # raise value Error\n+        self.app.conf.redis_backend_credential_provider = NonCredentialProvider()\n+        with pytest.raises(ValueError):\n+            x = self.Backend(app=self.app)\n+            assert x.connparams\n+            assert 'credential_provider' in x.connparams\n+\n     def test_url(self):\n         self.app.conf.redis_socket_timeout = 30.0\n         self.app.conf.redis_socket_connect_timeout = 100.0\n@@ -464,7 +482,7 @@ class test_RedisBackend(basetest_RedisBackend):\n \n         # without username and password\n         x = self.Backend(\n-            'redis://@vandelay.com:123/1?credential_provider=redis.CredentialProvider', app=self.app,\n+            'redis://@vandelay.com:123/1?credential_provider=redis.UsernamePasswordCredentialProvider', app=self.app,\n         )\n         assert x.connparams\n         assert x.connparams['host'] == 'vandelay.com'\n@@ -472,6 +490,16 @@ class test_RedisBackend(basetest_RedisBackend):\n         assert x.connparams['port'] == 123\n         assert isinstance(x.connparams['credential_provider'], CredentialProvider)\n \n+        # raise valueError\n+        with pytest.raises(ValueError):\n+            # some non-credential provider class\n+            # not ideal but serve purpose\n+            x = self.Backend(\n+                'redis://@vandelay.com:123/1?credential_provider=abc.ABC', app=self.app,\n+            )\n+            assert x.connparams\n+            assert 'credential_provider' in x.connparams\n+\n     def test_timeouts_in_url_coerced(self):\n         pytest.importorskip('redis')\n \n"
        }
    ]
}
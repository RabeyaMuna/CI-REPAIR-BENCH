{
    "sha_fail": "0e6f97d05d68c3d66d270865c31e9060c5a5b4de",
    "changed_files": [
        {
            "commit": "0e6f97d05d68c3d66d270865c31e9060c5a5b4de",
            "file_path": "tests/functional/botocore/test_s3.py",
            "diff": "diff --git a/tests/functional/botocore/test_s3.py b/tests/functional/botocore/test_s3.py\nindex 82ed4210f..a73abf7b1 100644\n--- a/tests/functional/botocore/test_s3.py\n+++ b/tests/functional/botocore/test_s3.py\n@@ -19,6 +19,7 @@ from botocore.compat import datetime, parse_qs, urlsplit\n from botocore.config import Config\n from botocore.exceptions import (\n     ClientError,\n+    ConnectionError,\n     ParamValidationError,\n     UnsupportedS3AccesspointConfigurationError,\n     UnsupportedS3ConfigurationError,\n@@ -2191,6 +2192,32 @@ def test_checksum_content_encoding(content_encoding, expected_header):\n         assert request_headers[\"Content-Encoding\"] == expected_header\n \n \n+@mock.patch('botocore.endpoint.URLLib3Session.send')\n+@mock.patch('botocore.client.apply_request_checksum')\n+def test_retries_reuse_request_checksum(\n+    mock_apply_request_checksum, mock_urllib3_session_send\n+):\n+    # Force retry behavior.\n+    mock_urllib3_session_send.side_effect = ConnectionError(error='Fake error')\n+    op_kwargs = {\n+        \"Bucket\": \"mybucket\",\n+        \"Key\": \"mykey\",\n+        \"Body\": b\"foo\",\n+        \"ChecksumAlgorithm\": \"CRC32\",\n+    }\n+    s3 = _create_s3_client(\n+        retries={\n+            'max_attempts': 1,\n+        }\n+    )\n+    with pytest.raises(ConnectionError):\n+        s3.put_object(**op_kwargs)\n+    # Ensure sending request was retried.\n+    assert mock_urllib3_session_send.call_count == 2\n+    # But request checksum was only calculated once.\n+    assert mock_apply_request_checksum.call_count == 1\n+\n+\n def _s3_addressing_test_cases():\n     # The default behavior for DNS compatible buckets\n     yield dict(\n@@ -3255,6 +3282,7 @@ def _create_s3_client(\n     s3_config=None,\n     signature_version='s3v4',\n     use_fips_endpoint=None,\n+    retries=None,\n ):\n     environ = {}\n     with mock.patch('os.environ', environ):\n@@ -3268,6 +3296,7 @@ def _create_s3_client(\n             signature_version=signature_version,\n             s3=s3_config,\n             use_fips_endpoint=use_fips_endpoint,\n+            retries=retries,\n         )\n         s3 = session.create_client(\n             's3',\n"
        }
    ]
}
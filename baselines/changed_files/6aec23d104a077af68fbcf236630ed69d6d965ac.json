{
    "sha_fail": "6aec23d104a077af68fbcf236630ed69d6d965ac",
    "changed_files": [
        {
            "commit": "6aec23d104a077af68fbcf236630ed69d6d965ac",
            "file_path": "framework/py/flwr/supernode/servicer/clientappio/clientappio_servicer.py",
            "diff": "diff --git a/framework/py/flwr/supernode/servicer/clientappio/clientappio_servicer.py b/framework/py/flwr/supernode/servicer/clientappio/clientappio_servicer.py\nindex 6fe5c257a..b4a79a025 100644\n--- a/framework/py/flwr/supernode/servicer/clientappio/clientappio_servicer.py\n+++ b/framework/py/flwr/supernode/servicer/clientappio/clientappio_servicer.py\n@@ -126,6 +126,43 @@ class ClientAppIoServicer(clientappio_pb2_grpc.ClientAppIoServicer):\n         # Return the token\n         return RequestTokenResponse(token=token)\n \n+    def GetRunIdsWithPendingMessages(\n+        self,\n+        request: GetRunIdsWithPendingMessagesRequest,\n+        context: grpc.ServicerContext,\n+    ) -> GetRunIdsWithPendingMessagesResponse:\n+        \"\"\"Get run IDs with pending messages.\"\"\"\n+        log(DEBUG, \"ClientAppIo.GetRunIdsWithPendingMessages\")\n+\n+        # Initialize state connection\n+        state = self.state_factory.state()\n+\n+        # Get run IDs with pending messages\n+        run_ids = state.get_run_ids_with_pending_messages()\n+\n+        # Return run IDs\n+        return GetRunIdsWithPendingMessagesResponse(run_ids=run_ids)\n+\n+    def RequestToken(\n+        self, request: RequestTokenRequest, context: grpc.ServicerContext\n+    ) -> RequestTokenResponse:\n+        \"\"\"Request token.\"\"\"\n+        log(DEBUG, \"ClientAppIo.RequestToken\")\n+\n+        # Initialize state connection\n+        state = self.state_factory.state()\n+\n+        # Attempt to create a token for the provided run ID\n+        try:\n+            token = state.create_token(request.run_id)\n+        except ValueError:\n+            # Return an empty token if A token already exists for this run ID,\n+            # indicating the run is in progress\n+            return RequestTokenResponse(token=\"\")\n+\n+        # Return the token\n+        return RequestTokenResponse(token=token)\n+\n     def GetToken(\n         self, request: GetTokenRequest, context: grpc.ServicerContext\n     ) -> GetTokenResponse:\n"
        },
        {
            "commit": "6aec23d104a077af68fbcf236630ed69d6d965ac",
            "file_path": "intelligence/kt/flwr/src/main/java/ai/flower/intelligence/Constants.kt",
            "diff": "diff --git a/intelligence/kt/flwr/src/main/java/ai/flower/intelligence/Constants.kt b/intelligence/kt/flwr/src/main/java/ai/flower/intelligence/Constants.kt\nindex 5750c4152..1dc887a8f 100644\n--- a/intelligence/kt/flwr/src/main/java/ai/flower/intelligence/Constants.kt\n+++ b/intelligence/kt/flwr/src/main/java/ai/flower/intelligence/Constants.kt\n@@ -22,4 +22,5 @@ internal object Constants {\n   const val ENCRYPTION_SERVER_PUBLIC_KEY_PATH = \"encryption/server-public-key\"\n   const val SDK = \"kt\"\n   const val VERSION = \"0.1.8\"\n+  val ALLOWED_ROLES = setOf(\"user\", \"system\", \"assistant\")\n }\n"
        },
        {
            "commit": "6aec23d104a077af68fbcf236630ed69d6d965ac",
            "file_path": "intelligence/kt/flwr/src/main/java/ai/flower/intelligence/Typing.kt",
            "diff": "diff --git a/intelligence/kt/flwr/src/main/java/ai/flower/intelligence/Typing.kt b/intelligence/kt/flwr/src/main/java/ai/flower/intelligence/Typing.kt\nindex d1c1a9aaf..5d97a49b5 100644\n--- a/intelligence/kt/flwr/src/main/java/ai/flower/intelligence/Typing.kt\n+++ b/intelligence/kt/flwr/src/main/java/ai/flower/intelligence/Typing.kt\n@@ -43,7 +43,17 @@ data class Progress(\n  * @property toolCalls An optional list of tool calls associated with the message.\n  */\n @Serializable\n-data class Message(val role: String, val content: String, val toolCalls: List<ToolCall>? = null)\n+data class Message(val role: String, val content: String, val toolCalls: List<ToolCall>? = null) {\n+  init {\n+    if (role !in Constants.ALLOWED_ROLES) {\n+      throw Failure(\n+        FailureCode.InvalidArgumentsError,\n+        \"Invalid message role: $role. \" +\n+          \"Available roles are: ${Constants.ALLOWED_ROLES.joinToString(\", \")}.\",\n+      )\n+    }\n+  }\n+}\n \n /** Represents a call to a specific tool with its name and arguments. */\n typealias ToolCall = Map<String, ToolCallDetails>\n"
        },
        {
            "commit": "6aec23d104a077af68fbcf236630ed69d6d965ac",
            "file_path": "intelligence/swift/src/Constants.swift",
            "diff": "diff --git a/intelligence/swift/src/Constants.swift b/intelligence/swift/src/Constants.swift\nindex a415df2f9..d8ad0d957 100644\n--- a/intelligence/swift/src/Constants.swift\n+++ b/intelligence/swift/src/Constants.swift\n@@ -38,4 +38,4 @@ let modelMapping: [String: ModelConfiguration] = [\n ]\n \n let sdk = \"Swift\"\n-let version = \"0.1.7\"\n+let version = \"0.1.8\"\n"
        },
        {
            "commit": "6aec23d104a077af68fbcf236630ed69d6d965ac",
            "file_path": "intelligence/swift/src/Engine/MlxEngine.swift",
            "diff": "diff --git a/intelligence/swift/src/Engine/MlxEngine.swift b/intelligence/swift/src/Engine/MlxEngine.swift\nindex ffdadbc57..2f0ac2143 100644\n--- a/intelligence/swift/src/Engine/MlxEngine.swift\n+++ b/intelligence/swift/src/Engine/MlxEngine.swift\n@@ -112,7 +112,7 @@ class MlxEngine: Engine {\n         }\n       }\n     }\n-    return Message(role: \"assistant\", content: result.output)\n+    return try Message(role: \"assistant\", content: result.output)\n   }\n \n   func fetchModel(model: String, callback: @escaping (Progress) -> Void) async throws {\n"
        },
        {
            "commit": "6aec23d104a077af68fbcf236630ed69d6d965ac",
            "file_path": "intelligence/swift/src/Engine/RemoteEngine.swift",
            "diff": "diff --git a/intelligence/swift/src/Engine/RemoteEngine.swift b/intelligence/swift/src/Engine/RemoteEngine.swift\nindex de6c99d81..ce0841778 100644\n--- a/intelligence/swift/src/Engine/RemoteEngine.swift\n+++ b/intelligence/swift/src/Engine/RemoteEngine.swift\n@@ -69,7 +69,7 @@ class RemoteEngine: RemoteEngineProtocol {\n           accumulatedResponse += deltaContent\n         }\n       }\n-      return Message(\n+      return try Message(\n         role: \"assistant\",\n         content: accumulatedResponse\n       )\n@@ -82,7 +82,7 @@ class RemoteEngine: RemoteEngineProtocol {\n     guard let message = response.choices.first?.message else {\n       throw Failure(code: .remoteError, message: \"No message found in response\")\n     }\n-    return Message(\n+    return try Message(\n       role: message.role,\n       content: message.content ?? \"\",\n       toolCalls: message.toolCalls\n"
        },
        {
            "commit": "6aec23d104a077af68fbcf236630ed69d6d965ac",
            "file_path": "intelligence/swift/src/FlowerIntelligence.swift",
            "diff": "diff --git a/intelligence/swift/src/FlowerIntelligence.swift b/intelligence/swift/src/FlowerIntelligence.swift\nindex 13d2b6477..b2e6e4db4 100644\n--- a/intelligence/swift/src/FlowerIntelligence.swift\n+++ b/intelligence/swift/src/FlowerIntelligence.swift\n@@ -85,8 +85,8 @@ public class FlowerIntelligence {\n         engine = mlxEngine\n       }\n     }\n-    let messages: [Message] = [Message(role: \"user\", content: input)]\n     do {\n+      let messages: [Message] = [try Message(role: \"user\", content: input)]\n       let result = try await engine.chat(\n         messages,\n         model: maybeOptions?.model,\n"
        },
        {
            "commit": "6aec23d104a077af68fbcf236630ed69d6d965ac",
            "file_path": "intelligence/swift/src/Typing.swift",
            "diff": "diff --git a/intelligence/swift/src/Typing.swift b/intelligence/swift/src/Typing.swift\nindex aabf9828e..77b9699a3 100644\n--- a/intelligence/swift/src/Typing.swift\n+++ b/intelligence/swift/src/Typing.swift\n@@ -21,8 +21,15 @@ public struct Progress: Codable {\n   public let description: String?\n }\n \n+enum Role: String, Codable, Sendable, CaseIterable {\n+  case user\n+  case system\n+  case assistant\n+}\n+\n /// Represents a message in a chat session.\n public struct Message: Codable, Sendable {\n+  private let _role: Role\n   /// The role of the sender (e.g., \"user\", \"system\", \"assistant\").\n   public let role: String\n \n@@ -32,11 +39,48 @@ public struct Message: Codable, Sendable {\n   /// An optional list of calls to specific tools\n   public let toolCalls: [ToolCall]?\n \n-  public init(role: String, content: String, toolCalls: [ToolCall]? = nil) {\n+  enum CodingKeys: String, CodingKey {\n+    case role, content, toolCalls\n+  }\n+\n+  public init(role: String, content: String, toolCalls: [ToolCall]? = nil) throws {\n+    guard let parsed = Role(rawValue: role) else {\n+      let validRoles = Role.allCases.map(\\.rawValue).joined(separator: \", \")\n+      throw Failure(\n+        code: .invalidArgumentsError,\n+        message: \"Invalid message role: \\(role). Available roles are: \\(validRoles).\"\n+      )\n+    }\n+    self._role = parsed\n     self.role = role\n     self.content = content\n     self.toolCalls = toolCalls\n   }\n+\n+  public init(from decoder: Decoder) throws {\n+    let container = try decoder.container(keyedBy: CodingKeys.self)\n+    let roleString = try container.decode(String.self, forKey: .role)\n+\n+    guard let parsed = Role(rawValue: roleString) else {\n+      let validRoles = Role.allCases.map(\\.rawValue).joined(separator: \", \")\n+      throw Failure(\n+        code: .invalidArgumentsError,\n+        message: \"Invalid message role: \\(roleString). Available roles are: \\(validRoles).\"\n+      )\n+    }\n+\n+    self._role = parsed\n+    self.role = roleString\n+    self.content = try container.decode(String.self, forKey: .content)\n+    self.toolCalls = try container.decodeIfPresent([ToolCall].self, forKey: .toolCalls)\n+  }\n+\n+  public func encode(to encoder: Encoder) throws {\n+    var container = encoder.container(keyedBy: CodingKeys.self)\n+    try container.encode(role, forKey: .role)\n+    try container.encode(content, forKey: .content)\n+    try container.encodeIfPresent(toolCalls, forKey: .toolCalls)\n+  }\n }\n \n /// Represents a call to a specific tool with its name and arguments.\n"
        },
        {
            "commit": "6aec23d104a077af68fbcf236630ed69d6d965ac",
            "file_path": "intelligence/swift/tests/FlowerIntelligenceTests.swift",
            "diff": "diff --git a/intelligence/swift/tests/FlowerIntelligenceTests.swift b/intelligence/swift/tests/FlowerIntelligenceTests.swift\nindex 600f16693..ed569603c 100644\n--- a/intelligence/swift/tests/FlowerIntelligenceTests.swift\n+++ b/intelligence/swift/tests/FlowerIntelligenceTests.swift\n@@ -20,7 +20,7 @@ class MockMlxEngine: Engine {\n     tools: [Tool]?\n   ) async throws -> Message {\n     lastMessages = messages\n-    return Message(role: \"assistant\", content: \"Mock Local Engine Response\")\n+    return try Message(role: \"assistant\", content: \"Mock Local Engine Response\")\n   }\n }\n \n@@ -43,7 +43,7 @@ class MockRemoteEngine: RemoteEngineProtocol {\n     tools: [Tool]?\n   ) async throws -> Message {\n     lastMessages = messages\n-    return Message(role: \"assistant\", content: \"Mock Remote Engine Response\")\n+    return try Message(role: \"assistant\", content: \"Mock Remote Engine Response\")\n   }\n }\n \n@@ -120,8 +120,8 @@ class FlowerIntelligenceTests {\n   @Test\n   func testChatFunctionWithArrayOfMessages() async throws {\n     let messages = [\n-      Message(role: \"system\", content: \"You are an AI\"),\n-      Message(role: \"user\", content: \"What is Swift?\"),\n+      try Message(role: \"system\", content: \"You are an AI\"),\n+      try Message(role: \"user\", content: \"What is Swift?\"),\n     ]\n     let options = ChatOptions(model: \"meta/llama3.2-1b\")\n     let result = await flowerIntelligence.chat(options: (messages, options))\n"
        }
    ]
}